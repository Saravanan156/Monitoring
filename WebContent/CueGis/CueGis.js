CueGis={};CueGis.version="5.3.2.0";CueGis.buildDate="02-02-2017";function CueGisInit(CueGis){if(!CueGis.library){CueGis.library={}}CueGis.library._utils=["CueGis/utils/Constants.js","CueGis/utils/Utils.js","CueGis/utils/DOM.js","CueGis/utils/AjaxRequest.js","CueGis/utils/GeoJsonUtils.js","CueGis/utils/HexToRGBAConverter.js","CueGis/GisApi.js"];CueGis.library._impl=["CueGis/impl/OpenLayerMap.js","CueGis/impl/map.js","CueGis/impl/mapControls.js","CueGis/impl/mapEvents.js","CueGis/impl/mapLayers.js","CueGis/impl/mapStyle.js","CueGis/impl/mapView.js","CueGis/impl/metric.js","CueGis/impl/poi.js","CueGis/impl/popup.js","CueGis/impl/clusterer.js","CueGis/impl/drawing.js","CueGis/impl/fence.js","CueGis/impl/geocoder.js","CueGis/impl/highlight.js","CueGis/impl/weather.js","CueGis/impl/latLng.js","CueGis/impl/router.js","CueGis/impl/utils.js","CueGis/impl/drawing/circle.js","CueGis/impl/drawing/line.js","CueGis/impl/drawing/point.js","CueGis/impl/drawing/polygon.js","CueGis/impl/drawing/rectangle.js"];CueGis.library._core=["CueGis/CuecentGISPallet.js","CueGis/PoiElement.js","CueGis/FencingElement.js","CueGis/TrackingElement.js","CueGis/LineBufferElement.js","CueGis/RouteElement.js","CueGis/RoutePlayBack.js","CueGis/DistanceElement.js","CueGis/MeasureTool.js","CueGis/DrawingTools.js","CueGis/ui/CueGisMenus.json","CueGis/ui/Implementation.js","CueGis/plugins/CueGisCRUD.js","CueGis/Loader.js"];CueGis.library._filesToLoad=[];var cssFiles=["CueGis/lib/ol/ol.css"];if(CueGis.isProduction){CueGis.library._thirdParty=["CueGis/lib/draggabilly.pkgd.min.js","CueGis/lib/javascript.util.js","CueGis/lib/jsts.js","CueGis/lib/ol/ol.js","CueGis/lib/ol/ol-drag.js"];CueGis.library._filesToLoad=CueGis.library._filesToLoad.concat(CueGis.library._thirdParty)}else{CueGis.library._thirdParty=["CueGis/lib/draggabilly.pkgd.min.js","CueGis/lib/javascript.util.js","CueGis/lib/jsts.js","CueGis/lib/ol/ol-debug.js","CueGis/lib/ol/ol-drag.js"];CueGis.library._filesToLoad=CueGis.library._filesToLoad.concat(CueGis.library._utils,CueGis.library._thirdParty,CueGis.library._impl,CueGis.library._core);cssFiles.push("CueGis/lib/ol/ol-ext.css")}CueGis.library.dynamicScriptLoader=function(filesToLoad){if(filesToLoad!=undefined&&filesToLoad.length>0){for(var index=0;index<filesToLoad.length;index++){document.write('<script type="text/javascript" src="'+filesToLoad[index]+'" ><\/script>')}}};CueGis.library.asyncScriptLoader=function(filesToLoad,callBack){if(filesToLoad!=undefined&&filesToLoad.length>0){for(var index=0;index<filesToLoad.length;index++){var ajReq=new AjaxRequest();ajReq.getRequest(filesToLoad[index],"",function(){if(this.readyState==4){eval(this.responseText)}}," text/plain",false)}if(callBack!=undefined){callBack.call(null)}}};CueGis.library.dynamicCssLoader=function(filesToLoad){if(filesToLoad!=undefined&&filesToLoad.length>0){for(var index=0;index<filesToLoad.length;index++){document.write('<link rel="stylesheet" href="'+filesToLoad[index]+'">')}}};CueGis.library.initConfigs=function(callBack){if(callBack!=undefined){callBack.call(null)}};CueGis.getConfiguration=function(configId){if(configId!=undefined&&CueGis._configurations!=undefined){return CueGis._configurations[configId]}return undefined};CueGis._implCache={};CueGis.getImplementation=function(options,callBack){if(options.dataSource==undefined||options.dataSource==null){throw"Datesource not found"}var impl=CueGis._implCache[options.dataSource];if(impl!=undefined){callBack.call(null,impl);return}CueGis.utils.DOM.addEvent(document,"WaitForGoogleLoadingCompleted",function(){if(callBack!=undefined){var _olImpl=new OpenLayerMap(config);CueGis._implCache[options.dataSource]=_olImpl;callBack.call(null,_olImpl)}});var config=CueGis.getConfiguration(options.dataSource);for(var key in options){if(options.hasOwnProperty(key)){config[key]=options[key]}}config.map=config.map.toUpperCase();if(config.map=="GOOGLE"){CueGis.utils.DOM.createElement({element:"script",attr:{type:"text/javascript",src:config.mapSrc}},document.body)}else{CueGis.googleHandler.call(null)}};CueGis.library.dynamicCssLoader(cssFiles);CueGis.library.dynamicScriptLoader(CueGis.library._filesToLoad);CueGis.googleHandler=function(){CueGis.utils.DOM.fireEvent({target:document,eventName:"WaitForGoogleLoadingCompleted",bubbles:true,cancelable:true,details:undefined})}}document.write('<script type="text/javascript" src="CueGis/config.json" ><\/script>');if(!CueGis){var CueGis={}}if(!CueGis.utils){CueGis.utils={}}if(!CueGis.utils.constants){CueGis.utils.constants={}}CueGis.utils.constants.FenceType={POLYGON:"POLYGON",RECTANGLE:"RECTANGLE",CIRCLE:"CIRCLE"};CueGis.utils.constants.Features={POI:"POI",FENCE:"FENCE",TRACKINGELEMENT:"TRACKINGELEMENT"};CueGis.utils.constants.OpenLayersBaseMaps={GOOGLE:"GOOGLE",OSM:"OSM",MAPQUEST:"MAPQUEST",BING:"BING",CATRODB:"CARTODB",HERE:"HERE"};CueGis.utils.constants.OSRM="OSRM";if(!CueGis){var CueGis={}}if(!CueGis.utils){CueGis.utils={}}CueGis.utils.clearAllElements=function(c,b){for(index in c){var a=c[index];if(Object.prototype.toString(a)!=="[object Function]"){if(a.setMap){a.setMap(null);if(b!=undefined){b.call(null,a)}}}}c=[]};CueGis.utils.isNonEmpty=function(a){if(a==undefined||a==null){return false}return true}(function(){Number.prototype.isLatitude=function(){return this>=-90&&this<=90};Number.prototype.isLongitude=function(){return this>=-180&&this<=180};Array.prototype.clone=function(){var a=this;var c=[];for(var b=0;b<a.length;b++){c.push(a[b])}return c};Array.prototype.pushIfNotPresent=function(a){if(this.indexOf(a)==-1){this.push(a)}};JSUtils={isArray:function(a){if(JSUtils.findType(a)=="[object Array]"){return true}else{return false}},findType:function(a){return Object.prototype.toString.call(a)}}}());function Inherito(b,a){b.prototype=Object.create(a.prototype);b.prototype.constructor=b}if(!CueGis){var CueGis={}}if(!CueGis.utils){CueGis.utils={}}CueGis.utils.DOM={init:function(){},addEvent:function(c,b,a){c.addEventListener(b,a,false)},removeEvent:function(c,b,a){if(c.detachEvent){c.detachEvent("on"+b,c[b+a]);c[b+a]=null}else{c.removeEventListener(b,a,false)}},createElement:function(d,f,b){if(d.hasOwnProperty("element")){var e=document.createElement(d.element);if(d.hasOwnProperty("attr")){for(var g in d.attr){if(g=="style"){e.style.cssText=d.attr[g]}else{if(g=="class"){if(e.classList==undefined){continue}e.classList.add(d.attr[g])}else{var a=document.createAttribute(g);a.value=d.attr[g];e.attributes.setNamedItem(a)}}}}if(d.hasOwnProperty("text")){var c=document.createTextNode(d.text);e.appendChild(c)}if(f!=null){if(b!=undefined&&b==true){if(f.childNodes.length>0){f.insertBefore(e,f.children[0])}else{f.appendChild(e)}}else{f.appendChild(e)}}return e}},fireEvent:function(a){if(typeof CustomEvent=="function"){var b=new CustomEvent(a.eventName,{bubbles:a.bubbles,cancelable:a.cancelable});if(a.details!=undefined){b.details=a.details}}if(typeof CustomEvent=="object"){var b=document.createEvent("Event");b.initEvent(a.eventName,a.bubbles,a.cancelable);document.dispatchEvent(b);return}a.target.dispatchEvent(b)},removeElement:function(a){a.parentElement.removeChild(a)},getElement:function(a){return document.getElementById(a)},getParent:function(a){return a.parentElement}};(function(){CueGis.utils.DOM.init()});function AjaxRequest(){this.xmlhttp=null;if(window.XMLHttpRequest){this.xmlhttp=new XMLHttpRequest()}else{this.xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}}AjaxRequest.prototype.postRequest=function(a,d,c,e,b){if(this.xmlhttp===null){console.log("xmlhttp is null unable to proceed");return}this.xmlhttp.open("POST",a,!b);this.xmlhttp.setRequestHeader("Content-Type",e);this.xmlhttp.send(d);this.xmlhttp.onreadystatechange=c};AjaxRequest.prototype.getRequest=function(a,d,c,e,b){if(this.xmlhttp===null){console.log("xmlhttp is null unable to proceed");return}this.xmlhttp.open("GET",a+"?"+d,!b);if(e!==undefined){this.xmlhttp.setRequestHeader("Content-Type",e)}this.xmlhttp.send();this.xmlhttp.onreadystatechange=c};CueGis.utils.GeoJsonUtils={generateGeoJsonForPolygon:function(b){var c={};c.type="Polygon";var a={};a.type="name";a.properties={};a.properties.name="EPSG:4326";c.crs=a;c.coordinates=[];c.coordinates.push(CueGis.utils.GeoJsonUtils.getCoordinatesArray(b));return c},getCoordinatesArray:function(c){var b=[];for(i=0;i<c.length;i++){var a=[];a.push(c[i].y);a.push(c[i].x);b.push(a)}return b},getCoordinatesArrayGoogle:function(c){var b=[];for(i=0;i<c.length;i++){var a=[];a.push(c[i].lng());a.push(c[i].lat());b.push(a)}return b}};(function(c){var b={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};if(!c.CueGis){c.CueGis={}}if(!c.CueGis.utils){c.CueGis.utils={}}CueGis.utils.HexToRGBA=function(g,f){g=g.toLowerCase();if(b.hasOwnProperty(g)){g=b[g].substr(1);return d(g,f)}else{if(!g.match(/^#?([0-9A-Fa-f]){3}\s*$|^#?([0-9A-Fa-f]){6}\s*$/)){throw"Invalid HEX value or color name"}else{g=(g.charAt(0)==="#"?g.substr(1):g);if(g.length===6){return d(g,f)}else{if(g.length===3){return a(g,f)}}}}};function d(l,h){var k=parseInt(l.substring(0,2),16);var j=parseInt(l.substring(2,4),16);var f=parseInt(l.substring(4,6),16);return e(k,j,f,h)}function a(l,h){var k=parseInt(l.substring(0,1)+l.substring(0,1),16);var j=parseInt(l.substring(1,2)+l.substring(1,2),16);var f=parseInt(l.substring(2,3)+l.substring(2,3),16);return e(k,j,f,h)}function e(k,j,f,h){return"rgba("+k+", "+j+", "+f+", "+h+")"}})(this);if(!CueGis){var CueGis={}}(function(){CueGis.GisApi={POI:{save:"/createPOI",get:"/getPOI",remove:"",getUnderCategory:"/getPOIByCategory/"},Fence:{get:"/getFence",save:"/createFence",remove:""},TrackingElement:{get:"/getGISPID/",getWithRoute:"/getFeeds",save:"/createGISEvent",remove:"",loadWithInArea:"/getGISPIDNearByGeoFence"}};return CueGis.GisApi}());function OpenLayerMap(a){this._baseLayerType=a.map;this.printLogs=(a.log===null||a.log===undefined)?false:true;this._rawConfig=a;for(var b in a){if(a.hasOwnProperty(b)){this[b]=a[b]}}this.map=null;this.directionService=undefined;this.eventsMap={singleclick:"click",pointerdrag:"drag",pointermove:"mouseover",contextmenu:"rightclick"};this.poiFeature=[];this._popUpOverLay=undefined;this.infoOverLays=[];this.markerCounter=1;this._mouseOutContenders=[];this._currentDraw=undefined;this.isDrawMode=false;this.drawDrag_=new ol.interaction.DragPan({});this.wgs84Sphere=new ol.Sphere(6378137);this.lengthUnits=["","m","ft","Km","mile"];this.styleCache=null;this.highlightedFeatures=[];this._defaultControls=this.getMapControls();this.defaultStyle=new ol.style.Style({stroke:new ol.style.Stroke({color:"#000000"}),fill:new ol.style.Fill({color:"rgba(255, 64, 0, 0.2)"})})}OpenLayerMap.prototype.createMap=function(a,d,c,f){if(d.center===null&&d.center.length==2){this.logMsg("The value of the center may be null or its is not an array of length 2",2);return null}if(a===null){this.logMsg("Container cannot be null",2);return null}var h=this;var b=d.center;this._mapOptions=d;var j=this.createLatLng(b[0],b[1]);var k;this._baseLayerType=this._baseLayerType.toUpperCase();this._baseView=this.createView(j,d);this._zoomHandlers=[];this._dragHandlers=[];var e=CueGis.utils.DOM.createElement({element:"DIV",attr:{id:"cueGisContainer",style:"height:100%;width:100%!important"}},a,true);this._parentContainer=e;f._parentContainer=e;var g=CueGis.utils.DOM.createElement({element:"DIV",attr:{id:"olContainer",style:"height:100%;width:100%!important"}},e,true);this._olContainer=g;this.map=new ol.Map({target:g,view:this._baseView,interactions:ol.interaction.defaults().extend([new ol_drag.Drag()]),controls:this.getMapControls(),layers:[]});e.addEventListener("mousedown",function(){h.dragging=true;h.map._cueGisDragging=true});e.addEventListener("mouseup",function(){h.dragging=false;h.map._cueGisDragging=false});this.cueGisContainer=e;this.initBaseMap(function(){f.initPallet()});this.initControls(d);this.initInfoWindow(a);this.initEventHandlers();this.initGeoCoder();this.initRouting();this.initWeatherAPI(f);this.map.on("click",c);this._baseView.on("change:center",function(){for(var l=0;l<h._dragHandlers.length;l++){h._dragHandlers[l].call(null)}});this._baseView.on("change:resolution",function(){for(var l=0;l<h._zoomHandlers.length;l++){h._zoomHandlers[l].call(null)}});this.logMsg("Map Created Successfully");return this.map};OpenLayerMap.prototype.getMapOptions=function(){return this._mapOptions};OpenLayerMap.prototype.fitExtent=function(b,a){this.map.getView().fit(b,a)};OpenLayerMap.prototype.updateMapOpacity=function(a){var b=this._baseLayerType.toUpperCase();if(b==CueGis.utils.constants.OpenLayersBaseMaps.GOOGLE){this.googleContainer.style.opacity=a}else{if(this._baseLayer){this._baseLayer.setOpacity(a)}}};OpenLayerMap.prototype.showMap=function(){var a=this._baseLayerType.toUpperCase();if(a==CueGis.utils.constants.OpenLayersBaseMaps.GOOGLE){this.googleContainer.style.display="block"}else{if(this._baseLayer){this._baseLayer.setVisible(true)}}};OpenLayerMap.prototype.hideMap=function(){var a=this._baseLayerType.toUpperCase();if(a==CueGis.utils.constants.OpenLayersBaseMaps.GOOGLE){this.googleContainer.style.display="none"}else{if(this._baseLayer){this._baseLayer.setVisible(false)}}};OpenLayerMap.prototype.isMapVisible=function(){if(this._baseLayer){return this._baseLayer.getVisible()}};OpenLayerMap.prototype.updateMapContainer=function(a){if(a===null||a===undefined){throw {name:"Invalid Container",message:"Container supplied for CuecentGISPallet:updateContainer() is invalid"}}if(typeof a=="string"){a=document.getElementById(a)}a.appendChild(this._parentContainer)};OpenLayerMap.prototype.addZoomHandler=function(a){this._zoomHandlers.push(a)};OpenLayerMap.prototype.removeZoomHandler=function(b){var a=this._zoomHandlers.indexOf(b);if(a>-1){this._zoomHandlers.splice(a,1)}};OpenLayerMap.prototype.addDragHandler=function(a){this._dragHandlers.push(a)};OpenLayerMap.prototype.removeDragHandler=function(b){var a=this._dragHandlers.indexOf(b);if(a>-1){this._dragHandlers.splice(a,1)}};OpenLayerMap.prototype.initControls=function(b){if(b.zoomSlider===true){this.map.addControl(new ol.control.ZoomSlider())}if(b.scale){var a=new ol.control.ScaleLine();a.setUnits(b.scale);this.map.addControl(a)}if(b.direction===true){this.map.addControl(this.getRotateNorthControl())}};OpenLayerMap.prototype.getMapAttributions=function(b){var a=[];a.push(ol.source.OSM.ATTRIBUTION);if(b.routing){if(b.routing.module.toUpperCase()==CueGis.utils.constants.OSRM){a.push(new ol.Attribution({html:'&nbsp;Routing by <a href="http://project-osrm.org/"> Project OSRM </a>'}));a.push(new ol.Attribution({html:'&nbsp;OSRM hosting by <a href="http://algo2.iti.kit.edu/">KIT</a>'}))}}if(b.geocoding){if(b.geocoding.module.toUpperCase()=="NOMINATIM"){}else{if(b.geocoding.module.toUpperCase()=="MAPQUESTNOMINATIM"){a.push(new ol.Attribution({html:'&nbsp;<p>Nominatim Search Courtesy of <a href="http://www.mapquest.com/">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png"></p>'}))}}}return a};OpenLayerMap.prototype.createAttribution=function(a){return new ol.Attribution({html:a})};OpenLayerMap.prototype.getMapControls=function(){return ol.control.defaults({attributionOptions:({collapsible:false}),rotate:false})};OpenLayerMap.prototype.getRotateNorthControl=function(a){var b=function(f){var c=f||{};var e=document.createElement("div");e.innerHTML="<img src=CueGis/icons/direction.png>";var h=this;var g=function(j){h.getMap().getView().setRotation(0)};e.addEventListener("click",g,false);e.addEventListener("touchstart",g,false);var d=document.createElement("div");d.className="rotate-north ol-unselectable ol-control";d.appendChild(e);ol.control.Control.call(this,{element:d,target:c.target})};ol.inherits(b,ol.control.Control);return new b()};OpenLayerMap.prototype.assignEvents=function(b,d,l,a,e,k){if(l===undefined||l===null){return}a._eventHandlers={};if(l.hasOwnProperty("click")){var j=l.click;j=this.getCallBackMethod(j);a._eventHandlers.click=function(m){k.call(null,m,a,e,b,d,j)}}if(l.hasOwnProperty("drag")){var g=l.drag;g=this.getCallBackMethod(g);a._eventHandlers.drag=function(m){k.call(null,m,a,e,b,d,g)}}if(l.hasOwnProperty("mouseover")){var f=l.mouseover;f=this.getCallBackMethod(f);a._eventHandlers.mouseover=function(m){k.call(null,m,a,e,b,d,f)}}if(l.hasOwnProperty("mouseout")){var h=l.mouseout;h=this.getCallBackMethod(h);a._eventHandlers.mouseout=function(m){k.call(null,m,a,e,b,d,h)}}if(l.hasOwnProperty("rightclick")){var c=l.rightclick;c=this.getCallBackMethod(c);a._eventHandlers.rightclick=function(m){k.call(null,m,a,e,b,d,c)}}};OpenLayerMap.prototype.initEventHandlers=function(){if(this.map===undefined){throw"Map is not defined"}this.map.on("singleclick",this._eventHandler(this,"click"));this.map.on("dblclick",this._eventHandler(this,"dblclick"));this.map.on("pointerdrag",this._eventHandler(this,"drag"));this.map.on("pointermove",this._pointerMoveHandler(this,"mouseover"));this.map.getViewport().addEventListener("contextmenu",this._contextMenuEventHandler(this))};OpenLayerMap.prototype._pointerMoveHandler=function(a,b){return function(n){if(a.dragging){return}if(a.isDrawMode===true){return}var d=[];a.map.forEachFeatureAtPixel(n.pixel,function(s){d.push(s)});if(n.type=="pointermove"){for(var g=0;g<a._mouseOutContenders.length;g++){var l=a._mouseOutContenders[g];var j=d.indexOf(l);if(j==-1){var q;if(l.clusterEvents||l._eventHandlers!==undefined){if(l.clusterEvents){q=l.clusterEvents.mouseout}else{q=l._eventHandlers.mouseout}if(q!==undefined){if(q.clusterEvents){q.call(null,n,l.get("features"),l)}else{q.call(null,n)}}a._mouseOutContenders.splice(j,1)}else{var f=l.get("features");if(f&&f.length>0){var c=f[0];if(c._eventHandlers){q=c._eventHandlers.mouseout;if(q){q.call(null,n);a._mouseOutContenders.splice(j,1)}}}}}}}if(!Array.isArray(d)){a._popUpOverLay.setPosition(undefined);return}if(d.length===0){a._popUpOverLay.setPosition(undefined);return}for(var h=0;h<d.length;h++){var r=d[h];if(a._mouseOutContenders.indexOf(r)!=-1){continue}if(r!==undefined){if(!r._isClustered&&!r.isHidden){if(r._toolTip!==undefined){a._popUpContent.innerHTML=r._toolTip;a._popUpOverLay.setPosition(n.coordinate)}else{var k=r.get("features");if(k){if(k[0]&&k[0]._toolTip){a._popUpContent.innerHTML=k[0]._toolTip;a._popUpOverLay.setPosition(n.coordinate)}}}}}else{a._popUpOverLay.setPosition(undefined);continue}if(r.clusterEvents||r._eventHandlers!==undefined){var p;if(r.clusterEvents){p=r.clusterEvents[b]}else{p=r._eventHandlers[b]}if(p!==undefined&&p!==null){if(r.clusterEvents){p.call(null,n,r.get("features"),r)}else{p.call(null,n)}if(n.type=="pointermove"){a._mouseOutContenders.pushIfNotPresent(r)}}}else{var m=r.get("features");if(m&&m.length>0){var e=m[0];if(e._eventHandlers){var o=e._eventHandlers[b];if(o){o.call(null,n);a._mouseOutContenders.pushIfNotPresent(r)}}}}}}};OpenLayerMap.prototype._eventHandler=function(a,b){return function(c){if(a.dragging){if((b=="drag")&&!CueGis.dragListener){return}}if(a.isDrawMode===true){return}var g=[];a.map.forEachFeatureAtPixel(c.pixel,function(j){if(g[g.length-1]==j){return false}if(j._isClustered){if(j.clusterEvents){var h=j.clusterEvents[b];if(h){h.call(null,c,j.get("features"),j)}}return}g.push(j)});for(var d=0;d<g.length;d++){var e=g[d];var f;if(e._eventHandlers!==undefined){f=e._eventHandlers[b];if(f!==undefined&&f!==null){f.call(null,c)}}else{if(e.getProperties().features===undefined){continue}e=e.getProperties().features[0];if(e._eventHandlers!==undefined){f=e._eventHandlers[b];if(f!==undefined&&f!==null){f.call(null,c)}}}}}};OpenLayerMap.prototype._contextMenuEventHandler=function(a){return function(c){c.preventDefault();var b={};b.map=a.map;b.originalEvent={clientX:c.clientX,clientY:c.clientY};b.pixel=a.map.getEventPixel(c);b.coordinate=a.map.getEventCoordinate(c);b.type="rightclick";var g=[];a.map.forEachFeatureAtPixel(b.pixel,function(j){if(j._isClustered===true){if(j.clusterEvents){var h=j.clusterEvents[b.type];h.call(null,b,j.get("features"))}return}g.push(j)});for(var d=0;d<g.length;d++){var e=g[d];var f;if(e._eventHandlers!==undefined){f=e._eventHandlers[b.type];if(f!==undefined&&f!==null){f.call(null,b)}}else{if(e.getProperties().features===undefined){continue}e=e.getProperties().features[0];if(e._eventHandlers!==undefined){f=e._eventHandlers[b.type];if(f!==undefined&&f!==null){f.call(null,b)}}}}}};OpenLayerMap.prototype.createFeatureContainer=function(b){var a=new ol.layer.Vector({map:this.map,source:new ol.source.Vector({features:new ol.Collection(),useSpatialIndex:false})});if(b){a._cueGisId=b}return a};OpenLayerMap.prototype.addFeature=function(b,a){a.getSource().addFeature(b)};OpenLayerMap.prototype.removeFeature=function(b,a){try{a.getSource().removeFeature(b)}catch(c){}};OpenLayerMap.prototype.showLayer=function(a){if(a){a.setVisible(true)}};OpenLayerMap.prototype.hideLayer=function(a){if(a){a.setVisible(false)}};OpenLayerMap.prototype.updateOpacity=function(b,a){b.setOpacity(a)};OpenLayerMap.prototype.getOpacity=function(a){return a.getOpacity()};OpenLayerMap.prototype.initBaseMap=function(callBack){var _this=this;if(_this._baseLayerType===undefined){if(_this.printLogs===true){console.log("Base map object not found")}return}var baseMapPlugin=_this._baseLayerType.toLowerCase();var aj=new AjaxRequest();aj.getRequest("CueGis/impl/baseMap/"+baseMapPlugin+".js",null,function(){if(this.readyState==4&&this.status==200){var globalEval=eval;_this.baseMapImpl=globalEval(this.responseText);_this.baseMapImpl.init(_this);if(callBack){callBack.call()}}if(this.readyState==4&&this.status==404){if(_this.printLogs===true){console.error("BaseMap module not found in the location CueGis/plugins/baseMap"+baseMapPlugin+".js")}}})};OpenLayerMap.prototype.setMapType=function(a){if(this.currentMapType==a){return}this.currentMapType=a;this.baseMapImpl.updateMapType(a,this)};OpenLayerMap.prototype.createStyle=function(b){var d="rgba(255, 255, 255, 0.2)";if(b.fillColor!=undefined){d=CueGis.utils.HexToRGBA(b.fillColor,(b.fillOpacity!=undefined?b.fillOpacity:0.5))}var c="RED";if(b.strokeColor!=undefined){c=CueGis.utils.HexToRGBA(b.strokeColor,(b.strokeOpacity!=undefined?b.strokeOpacity:0.5))}var a={color:c,width:b.strokeWidth!=undefined?b.strokeWidth:2};if(b.lineDash){a.lineDash=b.lineDash}return new ol.style.Style({fill:new ol.style.Fill({color:d}),stroke:new ol.style.Stroke(a),image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:d})})})};OpenLayerMap.prototype._createIcon=function(a){return new ol.style.Style({image:new ol.style.Icon(({anchor:[0.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:a}))})};OpenLayerMap.prototype.createView=function(a,b){return new ol.View({center:a,zoom:b.zoom||5,maxZoom:b.maxZoom||21,minZoom:b.minZoom||3})};OpenLayerMap.prototype.loadBookMarks=function(e){var d=this.map;var f=[];if(e!=null){var c=Number(e.latitude);var b=Number(e.longitude);var a=Number(e.zoomLevel);if(c.isLatitude()&&b.isLongitude()){f=this.createLatLng(c,b)}d.getView().setCenter(f);d.getView().setZoom(a)}};OpenLayerMap.prototype.getBookMarks=function(){var f={};var e=this.map;var g=e.getView().getCenter();var d=g[0];var b=g[1];var c=this.transformLatLng(b,d);var a=e.getView().getZoom();f.latitude=c[1];f.longitude=c[0];f.zoomLevel=a;return f};OpenLayerMap.prototype.getZoomLevel=function(){return this.map.getView().getZoom()};OpenLayerMap.prototype.setZoomLevel=function(b){if(b!=null&&b!=""&&b!=undefined){var a=Number(b);return this.map.getView().setZoom(a)}};OpenLayerMap.prototype.panTo=function(c,a){var b=[a,c];if(c.isLatitude()&&a.isLongitude()){b=this.createLatLng(c,a)}this.pan(b)};OpenLayerMap.prototype.pan=function(a){this.map.getView().setCenter(a)};OpenLayerMap.prototype.initDragZoom=function(a){CueGis.utils.DOM.addEvent(a,"click",function(){})};OpenLayerMap.prototype.isPointInBound=function(d,c){var b=d.getView().calculateExtent(d.getSize());var a=ol.extent.containsCoordinate(b,[c.lng,c.lat]);return a};OpenLayerMap.prototype.refreshMap=function(c){var d=this;if(d._googleMap!=undefined){var a=d._googleMap.getCenter();google.maps.event.trigger(d._googleMap,"resize");d._googleMap.setCenter(a)}var b=d.map.getView();b.setCenter(b.getCenter());d.map.updateSize()};OpenLayerMap.prototype.fitGeometryInMap=function(a){this.map.getView().fit(a,this.map.getSize())};OpenLayerMap.prototype.getExtent=function(){return this.map.getView().calculateExtent(this.map.getSize())};OpenLayerMap.prototype.distance=function(d,f){var b=d[0];var e=0;var c={};for(var a=1;a<d.length;a++){e=this.distanceBetweenPoints(f,c)}return e};OpenLayerMap.prototype._distanceBetweenPoints_=function(d,c){var d=d.getGeometry();var b=Math.round(d.getLength()*100)/100;var a;if(b>100){a=(Math.round(b/1000*100)/100)+" km"}else{a=(Math.round(b*100)/100)+" m"}return a};OpenLayerMap.prototype.getAreaForFence=function(g,f,b){if(g.getGeometry().getArea==undefined){return null}if(f==undefined){f=1}if(b==undefined){b=2}var a,j;if(b==1){a=g.getGeometry().getArea()}else{if(b==2){var c=this.map.getView().getProjection();var d=(g.getGeometry().clone().transform(c,"EPSG:4326"));var e=d.getLinearRing(0).getCoordinates();a=Math.abs(this.wgs84Sphere.geodesicArea(e))}}var h=(Math.round(a*100)/100);if(f==1){j=h}else{if(f==2){j=h*10.764}else{if(f==3){j=h/1000000}else{if(f==4){j=(h/1000000)*0.3861}}}}return parseFloat(j).toFixed(3)};OpenLayerMap.prototype.getAreaForFenceWithLabel=function(d,c,a){var b=this.getAreaForFence(d,c,a);if(c==undefined){c=1}return b+this.lengthUnits[c]+"<sup>2</sup>"};OpenLayerMap.prototype.getRadiusForFenceWithLabel=function(c,b){var a=this.getRadius(c);if(b==undefined){b=1}a=this.meterToXConverter(b,a);return a+this.lengthUnits[b]};OpenLayerMap.prototype.meterToXConverter=function(b,a){switch(b){case 1:output=a;break;case 2:output=(a*3.2808);break;case 3:output=(a/1000);break;case 4:output=(a*0.00062137);break}return parseFloat(output).toFixed(3)};OpenLayerMap.prototype.getLineLengthForLabel=function(l,b){var k=1,h="geodisc",a,f;if(b){if(b.unit){k=b.unit}if(b.type){h=b.type.toLowerCase()}}var j=l.getCoordinates();var d=this.map.getView().getProjection();var g=j.length;if(g>=3){a=j[g-3];f=j[g-2];var e=ol.proj.transform(a,d,"EPSG:4326");var c=ol.proj.transform(f,d,"EPSG:4326");length=this.wgs84Sphere.haversineDistance(e,c);length=this.meterToXConverter(k,length);return length+this.lengthUnits[k]}};OpenLayerMap.prototype.getNewLineLength=function(l,b){var k=1,h="geodisc",a,f;if(b){if(b.unit){k=b.unit}if(b.type){h=b.type.toLowerCase()}}var j=l.getCoordinates();var d=this.map.getView().getProjection();var g=j.length;if(g>=2){a=j[g-2];f=j[g-1];var e=ol.proj.transform(a,d,"EPSG:4326");var c=ol.proj.transform(f,d,"EPSG:4326");length=this.wgs84Sphere.haversineDistance(e,c);length=this.meterToXConverter(k,length);return length+this.lengthUnits[k]}};OpenLayerMap.prototype.createDistanceElement=function(d){var b=this;var a=new ol.interaction.Draw({source:d._layer.getSource(),type:"LineString",style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})})});this.map.addInteraction(a);var c=this.createSketch(a,d);return c};OpenLayerMap.prototype.createSketch=function(g,e){var d=this;this._currentDraw=g;this.isDrawMode=true;var k;this.map.addInteraction(this.drawDrag_);var h=null;var c;var f=this;var j;var m=function(o){if(o.dragging){return}var n=o.coordinate;if(h){var p;var r=(h.getGeometry());if(r instanceof ol.geom.LineString){p=f.getLineLengthWithLabel(r,e.metricConfig);n=r.getLastCoordinate();var q=o.pixel;q[0]=q[0]+50;q[1]=q[1]+50;n=f.map.getCoordinateFromPixel(q)}k.toolTipDiv.innerHTML=p;k.toolTip.setPosition(n)}};var a=function(x){if(x.dragging){return}var y=x.coordinate;if(h){if(j==false){j=true;return}var o;var u=(h.getGeometry());if(u instanceof ol.geom.LineString){o=f.getLineLengthForLabel(u,e.metricConfig);var w=u.getCoordinates();var s=w.length;if(s>=3){var n=w[s-3];var r=w[s-2];var v=(n[0]+r[0])/2;var t=(n[1]+r[1])/2;var q=[v,t];y=q}}var p=f.createMeasureTooltipExtended(e.toolTipCls);p.toolTipDiv.innerHTML=o;p.toolTip.setPosition(y);if(h.toolTips==undefined){h.toolTips=[]}h.toolTips.push(p)}};g.on("drawstart",function(n){h=n.feature;h.draggable=false;j=false;k=f.createMeasureTooltipExtended(e.labelCls);c=h.getGeometry().getFirstCoordinate();f.map.on("pointermove",m);f.map.on("singleclick",a);f._currentDraw.isCompleted=false},this);var l;var b=function(n){output=f.getLineLengthWithLabel(n.feature.getGeometry(),e.metricConfig);k.toolTipDiv.innerHTML=output;k.toolTip.setPosition(n.feature.getGeometry().getLastCoordinate());d.map.removeInteraction(d.drawDrag_);l=n.feature;var o=e._layer;l._markerOverLay=o;f.isDrawMode=false;if(e.events!=null){f.assignEvents(e,e._cuecentGisPallet,e.events,l,l,f.polyLineHandler)}l.setStyle(d.createStyle(e.distanceOptions));l.measureToolTip=k;k.toolTipDiv.className=e.labelCls||"tooltip tooltip-static";k.toolTip.setOffset([0,-7]);h=null;measureTooltipElement=null;f.map.un("pointermove",m);f.map.un("singleclick",a);f.map.removeInteraction(g);e.draw=l;e.list.push(l);e.currentDistance=l;f._currentDraw.isCompleted=true;if(e.queryOption!=undefined){e.queryOption.callBack.call(null,e,e._cuecentGisPallet,e._cuecentGisPallet.getImplObject(),e.currentDistance)}};g.once("drawend",b);g._selfDestruct=function(){if(f._currentDraw.isCompleted==false&&k){k.toolTipDiv=null;k.toolTip.setPosition(undefined);if(h){var o=h.toolTips;if(o){for(var n=0;n<o.length;n++){o[n].toolTip.setPosition(undefined)}}}}h=null;f.map.un("pointermove",m);f.map.un("singleclick",a)};this._currentDraw=g;return e};OpenLayerMap.prototype.getLineLength=function(n,b){if(n instanceof ol.Feature){n=n.getGeometry()}var a=0,c,l=1,j="geodisc";if(b){if(b.unit){l=b.unit}if(b.type){j=b.type.toLowerCase()}}if(j=="simple"){a=Math.round(n.getLength()*100)/100}else{if(j=="geodisc"){var k=n.getCoordinates();a=0;var e=this.map.getView().getProjection();var h=new ol.Sphere(6378137);for(var g=0,m=k.length-1;g<m;++g){var f=ol.proj.transform(k[g],e,"EPSG:4326");var d=ol.proj.transform(k[g+1],e,"EPSG:4326");a+=h.haversineDistance(f,d)}a=(Math.round(a*100)/100)}}a=this.meterToXConverter(l,a);return a};OpenLayerMap.prototype.getLineLengthWithLabel=function(a,d){var c=this.getLineLength(a,d);var b=1;if(d&&d.unit){b=d.unit}output=c+this.lengthUnits[b];return output};OpenLayerMap.prototype.removeDistanceElement=function(b,a){this.removeFeature(b,a._layer);b.measureToolTip.toolTip.setPosition(undefined);if(b.toolTips!=undefined){for(var c=0;c<b.toolTips.length;c++){b.toolTips[c].toolTip.setPosition(undefined)}}if(b._markerOverLay){this.removeFeature(b._startMarker,b._markerOverLay);this.removeFeature(b._endMarker,b._markerOverLay);this.map.removeLayer(b._markerOverLay)}};OpenLayerMap.prototype.removeFenceDistanceElement=function(a){a.toolTip.setPosition(undefined);this.map.removeOverlay(a.toolTip)};OpenLayerMap.prototype.panPOI=function(b){var a=b.getGeometry().getCoordinates();this.pan(a)};OpenLayerMap.prototype.getPoiPosition=function(a){if(a&&(geo=a.getGeometry()) instanceof ol.geom.Point){return this.getCuecentEventObject(a.getGeometry().getCoordinates())}};OpenLayerMap.prototype.initInfoWindow=function(a){this._popUp=CueGis.utils.DOM.createElement({element:"DIV",attr:{id:"_popUp","class":"ol-popup"}},a);this._popUpContent=CueGis.utils.DOM.createElement({element:"DIV",attr:{id:"_popUpContent"}},this._popUp);var b=this;this._popUpOverLay=new ol.Overlay({element:this._popUp});this.map.addOverlay(this._popUpOverLay);this.infoOverLays.push(this._popUpOverLay)};OpenLayerMap.prototype.createDisplay=function(b,d,a){if(b instanceof ol.Feature){b._toolTip=d;return}var c;b.getFeatures().forEach(function(e){c=e});c._toolTip=d};OpenLayerMap.prototype.createMeasureTooltipExtended=function(b){var a,c;if(a){a.parentNode.removeChild(a)}a=document.createElement("div");a.className=b||"tooltip tooltip-measure";c=new ol.Overlay({element:a,offset:[0,-15],positioning:"bottom-center"});this.map.addOverlay(c);this.infoOverLays.push(a.toolTip);return{toolTip:c,toolTipDiv:a}};var gloBin=[];OpenLayerMap.prototype.saveText=function(c,a){var d=this.createMeasureTooltipExtended("dummy");d.toolTipDiv.innerHTML=c;var b=this.map.getPixelFromCoordinate(a);gloBin[0]=b[0];gloBin[1]=b[1];b=this.map.getCoordinateFromPixel(b);d.toolTip.setPosition(b);return d};OpenLayerMap.prototype.removeText=function(a){this.map.removeOverlay(a.toolTip)};OpenLayerMap.prototype.adjustText=function(b){var a=b.toolTipDiv;var d=a.offsetHeight;var c=a.offsetWidth;b.toolTip.setOffset([(c/2),(d/2)])};OpenLayerMap.prototype.removeAddTextWnd=function(){this._txtInputWnd.style.display="none";this._txtInput.value=""};OpenLayerMap.prototype.clearClusterMarker=function(a,b){if(b!=undefined){a.getSource().getSource().removeFeature(b)}};OpenLayerMap.prototype.createMarkerClusterer=function(c){var d=new ol.source.Vector({features:[]});var b=new ol.source.Cluster({distance:32,source:d});var a=new ol.layer.Vector({source:b});var e=this;a.markerList=[];a.markerStyleList=[];a.markerHighlightStyleList={};a.styleCache={};a._source=d;if(c.events){a.events=c.events}a.setStyle(function(p,n){if(this.dragging){return}var m=p.get("features");var h=m.length;var l=10;if(h>99&&h<=999){l=15}else{if(h>999){l=20}}if(h==1){var g=m[0];var k=a.markerList.indexOf(g);if(g._isFocussed==true&&g._highlightType=="icon"){p.setStyle(a.markerHighlightStyleList[g._markerId])}else{if(a.markerStyleList[k]!=null){p.setStyle(a.markerStyleList[k])}}g._isClustered=false;g.clusterEvents=undefined;return}else{var f=a.styleCache[h];if(f==undefined){f=[new ol.style.Style({image:new ol.style.Circle({radius:l,stroke:new ol.style.Stroke({color:c.strokeColor}),fill:new ol.style.Fill({color:c.fillColor})}),text:new ol.style.Text({text:h==1?"?":h.toString(),fill:new ol.style.Fill({color:c.strokeColor})})})];a.styleCache[h]=f}p.setStyle(a.styleCache[h]);p._isClustered=true;p.clusterEvents=a.events;for(var j=0;j<h;j++){var o=m[j];o._isClustered=true}}});this.map.addLayer(a);return a};OpenLayerMap.prototype.addMarker=function(a,f,e,c){if(f==null||a==null){return}var b=this;if(!c){if(e){e.addFeature(f)}else{a.getSource().getSource().addFeature(f)}}var d=f.getStyle();a.markerList.push(f);a.markerStyleList.push(d);a.markerHighlightStyleList[f._markerId]=d};OpenLayerMap.prototype.clusterStyle=function(c,b,a){return function(h,e){var k=h.get("features");var g=k.length;if(g==1){var d=c.indexOf(k[0]);if(b[d]!=null){k[0].setStyle(b[d])}}else{for(var f=0;f<g;f++){k[f].setStyle(new ol.style.Style({}))}var j=a[g];if(!j){j=[new ol.style.Style({image:new ol.style.Circle({radius:10,stroke:new ol.style.Stroke({color:"#fff"}),fill:new ol.style.Fill({color:"#3399CC"})}),text:new ol.style.Text({text:g.toString(),fill:new ol.style.Fill({color:"#fff"})})})];a[g]=j}return j}}};OpenLayerMap.prototype.enableDrawing=function(c,b,a){var d=c.fenceType||"LINE";var e=this;this.stopDrawing();b.isDrawMode=true;if(d=="POLYGON"){this.enablePolygonDrawing(c,b,a)}else{if(d=="CIRCLE"){this.enableCircleDrawing(c,b,a)}else{if(d=="RECTANGLE"){this.enableRectangleDrawing(c,b,a)}else{if(d=="LINE"){this.createDistanceElement(c)}}}}};OpenLayerMap.prototype.stopDrawing=function(){if(this._currentDraw!=undefined){if(this._currentDraw.type&&this._currentDraw.type=="DrawText"){this._currentDraw.drawTool.removeTextWnd()}else{this.map.removeInteraction(this._currentDraw);this._currentDraw._selfDestruct()}}this.isDrawMode=false};OpenLayerMap.prototype.DrawTools=function(o,f,a,c){var b=o.fenceType;var h=this;this.stopDrawing();f.isDrawMode=true;if(b=="POLYGON"){var m=new ol.interaction.Draw({source:c._layer.getSource(),type:"Polygon"});f.map.addInteraction(m);this.map.addInteraction(this.drawDrag_);var e=function(q){h.map.removeInteraction(h.drawDrag_);var p=q.feature;p.setStyle(h.createStyle(o.fenceOptions));p.draggable=o.fenceOptions.draggable;f.map.removeInteraction(m);m.un("drawend",e);f.isDrawMode=false;if(c.callBack){c.callBack(c)}};m.once("drawend",e);m._selfDestruct=function(){m.un("drawend",e)};this._currentDraw=m}else{if(b=="CIRCLE"){var n=new ol.interaction.Draw({source:c._layer.getSource(),type:"Circle"});f.map.addInteraction(n);this.map.addInteraction(this.drawDrag_);var d=function(q){h.map.removeInteraction(h.drawDrag_);var p=q.feature;p.setStyle(h.createStyle(o.fenceOptions));p.draggable=o.fenceOptions.draggable;f.map.removeInteraction(n);n.un("drawend",d);f.isDrawMode=false;if(c.callBack){c.callBack(c)}};n.once("drawend",d);n._selfDestruct=function(){n.un("drawend",d)};this._currentDraw=n}else{if(b=="RECTANGLE"){h=this;var l=new ol.interaction.Draw({type:"LineString",geometryFunction:function(r,q){if(!q){q=new ol.geom.Polygon(null)}var s=r[0];var p=r[1];q.setCoordinates([[s,[s[0],p[1]],p,[p[0],s[1]],s]]);return q},maxPoints:2});f.map.addInteraction(l);this.map.addInteraction(this.drawDrag_);var g=function(q){h.map.removeInteraction(h.drawDrag_);var p=q.feature;p.setStyle(h.createStyle(o.fenceOptions));h.addFeature(p,c._layer);f.map.removeInteraction(l);l.un("boxend",g);f.isDrawMode=false;if(c.callBack){c.callBack(c)}};l.once("drawend",g);l._selfDestruct=function(){l.un("drawend",g)};this._currentDraw=l}else{if(b=="LINE"){h=this;var k=new ol.interaction.Draw({type:"LineString"});f.map.addInteraction(k);this.map.addInteraction(this.drawDrag_);var j=function(p){h.map.removeInteraction(h.drawDrag_);var q=p.feature;q.setStyle(h.createStyle(o.fenceOptions));h.addFeature(q,c._layer);f.map.removeInteraction(k);k.un("boxend",j);if(c.callBack){c.callBack(c)}f.isDrawMode=false};k.once("drawend",j);k._selfDestruct=function(){k.un("drawend",j)};this._currentDraw=k}else{if(b=="POINT"){h=this;var k=new ol.interaction.Draw({type:"Point"});f.map.addInteraction(k);this.map.addInteraction(this.drawDrag_);var j=function(p){h.map.removeInteraction(h.drawDrag_);var q=p.feature;q.setStyle(h.createStyle(o.fenceOptions));h.addFeature(q,c._layer);f.map.removeInteraction(k);k.un("boxend",j);f.isDrawMode=false;if(c.callBack){c.callBack(c)}};k.once("drawend",j);k._selfDestruct=function(){k.un("drawend",j)};this._currentDraw=k}}}}}return h.annotationFeatureOverlay};OpenLayerMap.prototype.clearDrawElement=function(a){var c=a._layer.getSource();var e=c.getFeatures();var b=[];for(var d=0;d<e.length;d++){b[d]=e[d]}for(var d=0;d<b.length;d++){c.removeFeature(b[d])}};OpenLayerMap.prototype.panFence=function(b){var a=b.getGeometry().getFirstCoordinate();this.pan(a)};OpenLayerMap.prototype.initGeoCoder=function(){var _this=this;if(_this.geocoding===undefined){if(_this.printLogs===true){console.log("Geocoding object not found")}return}if(_this.geocoding.module===undefined){if(_this.printLogs===true){console.log("Geocoding module not found")}return}var aj=new AjaxRequest();aj.getRequest("CueGis/impl/geocoding/"+_this.geocoding.module+".js",null,function(){if(this.readyState==4&&this.status==200){var globalEval=eval;_this.geocoding.impl=globalEval(this.responseText);_this.geocoding.impl.init(_this.geocoding)}if(this.readyState==4&&this.status==404){if(_this.printLogs===true){console.error("Geocoding module not found in the location CueGis/plugins/"+_this.geocoding.module+".js")}}})};OpenLayerMap.prototype.geoDecode=function(b,d,a,c){if(this.geocoding===undefined){return false}if(this.geocoding.impl===undefined){return false}this.geocoding.impl.geoCode(b,d,a,c)};OpenLayerMap.prototype.reverseGeoDecode=function(a,b){if(this.geocoding===undefined){return false}if(this.geocoding.impl===undefined){return false}this.geocoding.impl.reverseGeoCode(a,b)};OpenLayerMap.prototype.focus=function(d,h,c){if(c.animation){var a=c.animationClass||"circleOut";var b=document.getElementById("markerHighlight"+d._markerId);if(b==undefined){b=CueGis.utils.DOM.createElement({element:"div",attr:{id:"markerHighlight"+d._markerId,"class":a}},document.body)}else{if(d._animeClass!=a){b.className=a}}var f=d._highlight;if(f==undefined){featOverLay=new ol.Overlay({element:b});d._highlight=featOverLay;this.map.addOverlay(featOverLay)}var g=d.getGeometry().getCoordinates();featOverLay.setPosition(g);d._isFocussed=true;d._highlightType="animation";d._animeClass=a}else{var e=this._createIcon(c.icon||d._highlightIcon||h.highlightIcon);if(h.clusterer.markerHighlightStyleList){h.clusterer.markerHighlightStyleList[d._markerId]=e}d.setStyle(e);d._isFocussed=true;d._highlightType="icon"}d._styleConfig=c};OpenLayerMap.prototype.unfocus=function(a){if(a._isFocussed==true){if(a._highlightType=="icon"){a.setStyle(this._createIcon(a._icon))}else{if(a._highlightType=="animation"){if(a._highlight){a._highlight.setPosition(undefined)}}}a._isFocussed=false}};OpenLayerMap.prototype.highLightFence=function(c,b){if(c!=null&&c!=""&&c!=undefined){var a=c.getStyle();this.styleCache=a;if(b!=null&&b!=""&&b!=undefined){c.setStyle(this.createStyle(b))}else{c.setStyle(this.defaultStyle)}this.highlightedFeatures.push(c)}};OpenLayerMap.prototype.UnHighLightFence=function(b){if(b!=null&&b!=""&&b!=undefined){if(this.styleCache==undefined){b.setStyle(this.defaultStyle)}else{b.setStyle(this.styleCache)}var a=this.highlightedFeatures.indexOf(b);if(a!=-1){this.highlightedFeatures.splice(a,1)}}};OpenLayerMap.prototype.initWeatherAPI=function(cuecentGISPallet){var _this=this;this.weatherImpl=undefined;if(_this.weatherConfig===undefined){if(_this.printLogs===true){console.log("Weather config not found")}return}if(_this.weatherConfig.module===undefined){if(_this.printLogs===true){console.log("weatherConfig module not found")}return}var aj=new AjaxRequest();aj.getRequest("CueGis/plugins/"+_this.weatherConfig.module+".js",null,function(){if(this.readyState==4&&this.status==200){var globalEval=eval;_this.weatherImpl=globalEval(this.responseText);_this.weatherImpl.init(_this.weatherConfig,_this,cuecentGISPallet)}if(this.readyState==4&&this.status==404){if(_this.printLogs===true){console.error("WeatherConfig module not found in the location CueGis/plugins/"+_this.weatherConfig.module+".js")}}})};OpenLayerMap.prototype.showWeather=function(){if(this.weatherImpl===undefined){console.log("WARNING: WeatherConfig not added in config file");return}this.weatherImpl.showWeather()};OpenLayerMap.prototype.hideWeather=function(){if(this.weatherImpl===undefined){console.log("WARNING: WeatherConfig not added in config file");return}this.weatherImpl.hideWeather()};OpenLayerMap.prototype.createLatLng=function(b,a){return new ol.proj.transform([a,b],"EPSG:4326","EPSG:3857")};OpenLayerMap.prototype.transformLatLng=function(b,a){return new ol.proj.transform([a,b],"EPSG:3857","EPSG:4326")};OpenLayerMap.prototype.getLatLngFromEvent=function(a){return this.getLatLngFromCoordinate(a.coordinate)};OpenLayerMap.prototype.getLatLngFromCoordinate=function(c){var b=[];var a=this.transformLatLng(c[1],c[0]);b[0]=a[1];b[1]=a[0];return b};OpenLayerMap.prototype.getCuecentEventObject=function(c){var a={};var b=this.getLatLngFromCoordinate(c);a.lat=b[0];a.lng=b[1];a._coords=c;return a};OpenLayerMap.prototype.createCoordinate=function(b,a){return[a,b]};OpenLayerMap.prototype.getPixelFromCoordinate=function(c,a){var b=[c,a];return this.map.getPixelFromCoordinate(b)};OpenLayerMap.prototype.initRouting=function(){var _this=this;if(_this.routing===undefined){if(_this.printLogs===true){console.log("Routing object not found")}return}if(_this.routing.module===undefined){if(_this.printLogs===true){console.log("Routing module not found")}return}var aj=new AjaxRequest();aj.getRequest("CueGis/impl/routing/"+_this.routing.module+".js",null,function(){if(this.readyState==4&&this.status==200){var globalEval=eval;_this.routing.impl=globalEval(this.responseText);_this.routing.impl.init(_this.routing)}if(this.readyState==4&&this.status==404){if(_this.printLogs===true){console.error("Routing module not found in the location CueGis/plugins/"+_this.routing.module+".js")}}})};OpenLayerMap.prototype.DirectionServiceResult={OK:"OK",INVALID_REQUEST:"INVALID_REQUEST",MAX_WAYPOINTS_EXCEEDED:"MAX_WAYPOINTS_EXCEEDED",NOT_FOUND:"NOT_FOUND",OVER_QUERY_LIMIT:"OVER_QUERY_LIMIT",REQUEST_DENIED:"REQUEST_DENIED",UNKNOWN_ERROR:"UNKNOWN_ERROR",ZERO_RESULTS:"ZERO_RESULTS"};OpenLayerMap.prototype.findRoute=function(b,a){if(this.routing===undefined){return false}if(this.routing.impl===undefined){return false}if(b.type!=="formatRoute"){this._parseForNames(b)}this.routing.impl.findRoute(b,a)};OpenLayerMap.prototype._parseForNames=function(g){var a=[];a.push(g.source);var d=g.wayPoints;for(var c=0;c<d.length;c++){a.push(d[c].location)}a.push(g.destination);var b=this.geocoding.impl.bulkGeoCode(a);g.source=b[0];g.destination=b[b.length-1];var e=b.slice(1,b.length-1);g.wayPoints=[];for(c=0;c<e.length;c++){var f={};f.location=e[c];g.wayPoints.push(f)}};OpenLayerMap.prototype.getCallBackMethod=function(d){if(typeof d=="string"){if(window[d]&&typeof window[d]=="function"){d=window[d]}else{if(d.indexOf(".")!=-1){var a=d.split(".");var c=window;for(index in a){var b=a[index];if(c[b]){c=c[b]}}d=c}}}return d};OpenLayerMap.prototype.createArray=function(){return[]};OpenLayerMap.prototype.logMsg=function(b,a){if(a==undefined){a=0}if(this.printLogs){switch(a){case 0:console.log(b);break;case 1:if(console.warn){console.warn(b)}else{console.log("WARNING :: "+b)}break;case 2:if(console.error){console.error(b)}else{console.log("ERROR :: "+b)}break;case 3:if(console.trace){console.trace(b)}case 4:console.log(b);break}}};OpenLayerMap.prototype.clearAllElements=function(f,e,d){for(var b=0;b<f.length;b++){var c=f[b];if(c instanceof ol.Feature){var a=false;if(c.fenceType!=undefined&&c.fenceType==="POLYGON"){this.removeFeature(c,d._layer);a=true}else{if(c.getGeometry() instanceof ol.geom.LineString){this.removeFeature(c,d._layer);a=true}}if(a==true){if(e!=undefined){e.call(null,c)}}}}f=[]};OpenLayerMap.prototype.createCircle=function(g,c,f,b,a,e){f.center=b;f.radius=parseInt(a);var d=new ol.Feature({geometry:new ol.geom.Circle(f.center,f.radius)});d.setStyle(this.createStyle(f));this.addFeature(d,g._layer);d.fenceType=CueGis.utils.constants.FenceType.CIRCLE;d.featureType=CueGis.utils.constants.Features.FENCE;d.draggable=f.draggable;if(e!==null){this.assignEvents(g,c,e,d,d,this.circleHandler)}return d};OpenLayerMap.prototype.enableCircleDrawing=function(j,c,a){var e=this;var g;var h;var f=new ol.interaction.Draw({source:j._layer.getSource(),type:"Circle"});c.map.addInteraction(f);this.map.addInteraction(this.drawDrag_);var b=function(l){e.map.removeInteraction(e.drawDrag_);var k=l.feature;k.setStyle(e.createStyle(j.fenceOptions));k.fenceType=CueGis.utils.constants.FenceType.CIRCLE;k.featureType=CueGis.utils.constants.Features.FENCE;if(j.events!==null){if(j.events){var m=j.events.drag;j.events.drag=function(n,p,o){if(p){}if(m!==undefined){m.call(null,arguments)}}}e.assignEvents(j,a,j.events,k,k,e.circleHandler)}k.draggable=j.fenceOptions.draggable;j.drawFence=k;j.drawFence.pId=undefined;j.drawFence.isNew=true;j.drawFence.fenceType="CIRCLE";j.fenceList.push(j.drawFence);j.currentFence=j.drawFence;c.map.removeInteraction(f);f.un("drawend",b);if(j.metricConfig!==undefined){if(j.metricConfig!==undefined&&g){output=c.getRadiusForFenceWithLabel(l.feature,j.metricConfig.unit);g.toolTipDiv.innerHTML=output;k.radiusLine=e.createPolyLine(j.fenceOptions,j,a,j.events);if(k.radiusLine){k.radiusLine.getGeometry().appendCoordinate(k.getGeometry().getCenter());k.radiusLine.getGeometry().appendCoordinate(k.getGeometry().getLastCoordinate())}}j.drawFence.measureElement=g;e.map.un("pointermove",d)}if(j.queryOption!==undefined){j.queryOption.callBack.call(null,j,a,c,j.currentFence)}e._currentDraw.isCompleted=true;c.isDrawMode=false};var d=function(l){if(l.dragging){return}var k=l.coordinate;if(h){var m;var n=(h.getGeometry());if(n instanceof ol.geom.Circle){if(j.metricConfig===undefined){j.metricConfig={unit:1,calcType:2}}m=e.getRadiusForFenceWithLabel(h,j.metricConfig.unit);k=n.getLastCoordinate()}g.toolTipDiv.innerHTML=m;g.toolTip.setPosition(k)}};if(j.metricConfig!==undefined){f.on("drawstart",function(k){h=k.feature;g=e.createMeasureTooltipExtended(j.labelCls||"tooltip");e.map.on("pointermove",d);e._currentDraw.isCompleted=false},this)}f.once("drawend",b);f._selfDestruct=function(){f.un("drawend",b);if(e._currentDraw.isCompleted===false&&g){g.toolTip.setPosition(undefined);e.map.un("pointermove",d)}};this._currentDraw=f};OpenLayerMap.prototype.getLatLngFromCircularFence=function(k){var h=k.getGeometry();var f=h.getRadius();h.transform("EPSG:3857","EPSG:4326");var b=h.getCenter();var j=[];var c=f/((Math.PI/180)*6378137);var d={};d.type="Polygon";var m={};m.type="name";m.properties={name:"EPSG:4326"};d.crs=m;var e=new jsts.geom.Coordinate(b[1],b[0]);var n=new jsts.geom.GeometryFactory();var l=n.createPoint(e);j=l.buffer(c,180,1);j=j.getCoordinates();d.coordinates=[];d.coordinates.push(CueGis.utils.GeoJsonUtils.getCoordinatesArray(j));var a=d.coordinates[0][0];var g=a.clone();d.coordinates[0].push(g);h.transform("EPSG:4326","EPSG:3857");return d};OpenLayerMap.prototype.circleHandler=function(m,a,f,b,d,g){var h=d.getImplObject();var c=d.map;var e=m.originalEvent;var l={x:undefined,y:undefined};b.currentFence=a;var j=m.coordinate;var k=h.getCuecentEventObject(j);g.call(null,k,f,b,d,this,e.clientX,e.clientY,l.x,l.y)};OpenLayerMap.prototype.getRadius=function(e){var h=e.getGeometry();var g=h.getCenter();var d=h.getLastCoordinate();var c=this.map.getView().getProjection();var f=ol.proj.transform(g,c,"EPSG:4326");var b=ol.proj.transform(d,c,"EPSG:4326");var a=this.wgs84Sphere.haversineDistance(f,b);return a};OpenLayerMap.prototype.getFenceCenter=function(c){var d;var b=c.getGeometry().getCenter();var a={};a.lat=b[1];a.lng=b[0];return a};OpenLayerMap.prototype.polyLineHandler=function(c,a,f,b,d,g){var j=this;var h=d.getImplObject();if(b.currentDistance){b.currentDistance=a}if(b.currentRoute){b.currentRoute=a}var k=c.coordinate;var e=c.originalEvent;var l=h.getCuecentEventObject(k);g.call(null,l,a,b,d,d.implObject,e.clientX,e.clientY)};OpenLayerMap.prototype.removePolyLine=function(a,b){this.removeFeature(a,b._layer)};OpenLayerMap.prototype.createPolyLine=function(b,f,a,c,d){var g=new ol.geom.LineString([]);var e=new ol.Feature({geometry:g});e.draggable=b.draggable;if(d===undefined){e.setStyle(this.createStyle(b))}else{e.setStyle(d)}this.addFeature(e,f._layer);if(c!==null&&c!==undefined){this.assignEvents(f,a,c,e,e,this.polyLineHandler)}return e};OpenLayerMap.prototype.getLatLngFromPolyline=function(d){d.getGeometry().transform("EPSG:3857","EPSG:4326");var a=d.getGeometry();var f=a.getCoordinates();var c=[];for(var b=0;b<f.length;b++){var e=[];e.push(f[b][1]);e.push(f[b][0]);c.push(e)}d.getGeometry().transform("EPSG:4326","EPSG:3857");return c};OpenLayerMap.prototype.addPointInPolyLine=function(b,c,a){if(b!==null){b.getGeometry().appendCoordinate(this.createLatLng(c,a))}};OpenLayerMap.prototype.getLatLngsFromPolyLine=function(d){var e=d.getGeometry();e.transform("EPSG:3857","EPSG:4326");var f=new ol.format.GeoJSON();var a=f.writeFeatures([d]);var c=JSON.parse(a);e.transform("EPSG:4326","EPSG:3857");c=c.features[0].geometry;var b={};b.type="name";b.properties={name:"EPSG:4326"};c.crs=b;return c};OpenLayerMap.prototype.createMarker=function(a,e,d,h,b,k){var g={image:new ol.style.Icon(({anchor:[0.5,0.5],src:"CueGis/icons/marker32.png",rotation:0}))};var j=d.text;if(j){g.text=new ol.style.Text(({font:j.font||"Arial",fill:new ol.style.Fill({color:j.color||"BLACK"}),textAlign:"center",offsetY:j.offsetY?j.offsetY:27,rotation:j.rotation?(j.rotation*0.0174532925):0,text:j.data,scale:j.scale||1}));if(j.textAlone){delete (g.image)}}if(d.icon){g.image=new ol.style.Icon(({anchor:d.anchor==undefined?[0.5,0.5]:d.anchor,src:d.icon,rotation:d.rotation?(d.rotation*0.0174532925):0}))}var f=new ol.style.Style(g);var c=new ol.Feature({geometry:new ol.geom.Point(this.createLatLng(h,b))});c.setStyle(f);if(a===null||a===undefined){this.addFeature(c,a._layer)}if(!!a&&a.isClusteringEnabled===false){this.addFeature(c,a._layer)}c.draggable=d.draggable;if(k!==null){this.assignEvents(a,e,k,c,c,this.markerHandler)}c._markerId="Marker-"+(this.markerCounter++);c._icon=d.icon;c._highlightIcon=d.highlightIcon;c._isClustered=false;c._text=j;return c};OpenLayerMap.prototype.removeMarker=function(b,a){this.removeFeature(b,a._layer);if(b._isFocussed&&b._highlightType=="animation"){this.unfocus(b);if(b._highlight){this.map.removeOverlay(b._highlight)}}};OpenLayerMap.prototype.enableMarker=function(b,a){this.addFeature(b,a._layer);if(b._isFocussed&&b._highlightType=="animation"){this.focus(b,a,b._styleConfig);if(b._highlight){this.map.addOverlay(b._highlight)}}};OpenLayerMap.prototype.getLatLngFromMarker=function(a){var c=a.getPosition();var b=[];b[0]=c.lat();b[1]=c.lng();return b};OpenLayerMap.prototype.markerHandler=function(l,a,e,b,c,f){var j=a.getGeometry().getCoordinates();var d=l.originalEvent;var h=this;var g=c.getImplObject();var k=g.getCuecentEventObject(j);f.call(null,k,e,b,c,h,d.clientX,d.clientY)};OpenLayerMap.prototype.updateMarker=function(a,b){var c=this.createLatLng(b.lat,b.lng);a.getGeometry().setCoordinates(c);if(a._isFocussed&&a._highlightType=="animation"){a._highlight.setPosition(c)}};OpenLayerMap.prototype.getMarkerPosition=function(a){var b=a.getGeometry().getCoordinates();return{lat:b[1],lng:b[0]}};OpenLayerMap.prototype.getMarkerPosition=function(a){var b=a.getGeometry().getCoordinates();return{lat:b[1],lng:b[0]}};OpenLayerMap.prototype.updateMarkerIcon=function(b,e,d,f){var a={};if(e!==undefined&&e!==null&&e.trim()!==""){a.image=new ol.style.Icon(({anchor:[0.5,0.5],src:e||"CueGis/icons/marker32.png",rotation:d?(d*0.0174532925):0}))}else{if(b._icon){a.image=new ol.style.Icon(({anchor:[0.5,0.5],src:b._icon||"CueGis/icons/marker32.png",rotation:d?(d*0.0174532925):0}))}}if(f!==undefined&&f!==null){a.text=new ol.style.Text(({font:f.font||"Arial",fill:new ol.style.Fill({color:f.color||"BLACK"}),textAlign:"center",offsetY:f.offsetY?f.offsetY:27,rotation:f.rotation?(f.rotation*0.0174532925):0,text:f.data,scale:f.scale||1}))}else{if(b._text){a.text=new ol.style.Text(({textAlign:"center",offsetY:f.offsetY?f.offsetY:27,font:b._text.font||"Arial",fill:new ol.style.Fill({color:b._text.color||"BLACK"}),rotation:b._text.rotation?(b._text.rotation*0.0174532925):0,text:b._text.data,scale:b._text.scale||1}))}}var c=new ol.style.Style(a);b.setStyle(c);b._icon=e||"CueGis/icons/marker32.png";return c};OpenLayerMap.prototype.createPolygon=function(f,a,b,e){var d=new ol.geom.Polygon([]);var c=new ol.Feature({geometry:d});c.setStyle(this.createStyle(b));c.draggable=b.draggable;this.addFeature(c,f._layer);if(e!==null){this.assignEvents(f,a,e,c,c,this.polygonHandler)}return c};OpenLayerMap.prototype.addPolygonFeature=function(a,b){if(a instanceof ol.Feature){this.addFeature(a,b._layer)}};OpenLayerMap.prototype.enablePolygonDrawing=function(m,d,a){var h=new ol.interaction.Draw({source:m._layer.getSource(),type:"Polygon"});var f=this;var k;var l;d.map.addInteraction(h);this.map.addInteraction(this.drawDrag_);var j=false;var b=function(r){f.map.removeInteraction(f.drawDrag_);var q=r.feature;q.setStyle(f.createStyle(m.fenceOptions));if(m.events!==null){if(m.metricConfig!==undefined){if(m.events){var t=m.events.drag;m.events.drag=function(v,x,w){if(x){if(x.measureElement){x.measureElement.toolTip.setPosition(x.getGeometry().getLastCoordinate())}}if(t!==undefined){t.call(null,arguments)}}}}f.assignEvents(m,a,m.events,q,q,f.polygonHandler)}q.draggable=m.fenceOptions.draggable;m.drawFence=q;m.drawFence.pId=undefined;m.drawFence.isNew=true;m.drawFence.fenceType="POLYGON";m.fenceList.push(m.drawFence);m.currentFence=m.drawFence;d.map.removeInteraction(h);if(m.metricConfig!==undefined){g(q,f);var p=f.getAreaForFenceWithLabel(r.feature,m.metricConfig.unit,m.metricConfig.calcType);k.toolTipDiv.innerHTML=p;var s=r.feature.getGeometry().getExtent();var o=(s[0]+s[2])/2;var n=(s[1]+s[3])/2;var u=[o,n];k.toolTip.setPosition(u);m.drawFence.measureElement=k;f.map.un("pointermove",e);f.map.un("singleclick",c)}if(m.queryOption!==undefined){m.queryOption.callBack.call(null,m,a,d,m.currentFence)}f._currentDraw.isCompleted=true;d.isDrawMode=false};var e=function(o){if(o.dragging){return}var n=o.coordinate;if(l){var p;var q=(l.getGeometry());if(q instanceof ol.geom.Polygon){if(m.metricConfig===undefined){m.metricConfig={unit:1,calcType:2}}p=f.getNewLineLength(q.getLinearRing(0),m.metricConfig);n=q.getLastCoordinate()}if(p!==undefined){if(k.toolTipDiv){k.toolTipDiv.innerHTML=p}k.toolTip.setPosition(n)}}};var c=function(y){if(y.dragging){return}var z=y.coordinate;if(l){if(j===false){j=true;return}var p;var o;var v=(l.getGeometry());if(v instanceof ol.geom.Polygon){if(m.metricConfig===undefined){m.metricConfig={unit:1,calcType:2}}o=f.getLineLengthForLabel(v.getLinearRing(0),m.metricConfig);var x=v.getLinearRing(0).getCoordinates();var t=x.length;if(t>=3){var n=x[t-3];var s=x[t-2];var w=(n[0]+s[0])/2;var u=(n[1]+s[1])/2;var r=[w,u];z=r}}var q=f.createMeasureTooltipExtended(m.toolTipCls);q.toolTipDiv.innerHTML=o;q.toolTip.setPosition(z);if(l.toolTips==undefined){l.toolTips=[]}l.toolTips.push(q)}};h._selfDestruct=function(){if(f._currentDraw.isCompleted==false&&k){f.map.un("pointermove",e);f.map.un("singleclick",c);k.toolTipDiv=null;k.toolTip.setPosition(undefined);if(l){var o=l.toolTips;for(var n=0;n<o.length;n++){o[n].toolTip.setPosition(undefined)}}}h.un("drawend",b)};if(m.metricConfig!=undefined){h.on("drawstart",function(n){l=n.feature;k=f.createMeasureTooltipExtended(m.labelCls||"tooltip");f.map.on("pointermove",e);f.map.on("singleclick",c);f._currentDraw.isCompleted=false},this)}h.once("drawend",b);function g(o,t){var w=(o.getGeometry()),z,p;if(w instanceof ol.geom.Polygon){if(m.metricConfig===undefined){m.metricConfig={unit:1,calcType:2}}p=t.getNewLineLength(w.getLinearRing(0),m.metricConfig);var y=w.getLinearRing(0).getCoordinates();var u=y.length;if(u>=3){var n=y[u-2];var s=y[u-1];var x=(n[0]+s[0])/2;var v=(n[1]+s[1])/2;var r=[x,v];z=r}}var q=t.createMeasureTooltipExtended(m.toolTipCls);q.toolTipDiv.innerHTML=p;q.toolTip.setPosition(z);if(o.toolTips==undefined){o.toolTips=[]}o.toolTips.push(q)}this._currentDraw=h};OpenLayerMap.prototype.removePolygon=function(b,a){if(b instanceof ol.Feature){this.removeFeature(b,a._layer);if(b.toolTips!=undefined){for(var c=0;c<b.toolTips.length;c++){b.toolTips[c].toolTip.setPosition(undefined)}}return}};OpenLayerMap.prototype.getLatLngFromFence=function(c){geometry=c.getGeometry();geometry.transform("EPSG:3857","EPSG:4326");var f=new ol.format.GeoJSON();var a=f.writeFeatures([c]);var b=JSON.parse(a);geometry.transform("EPSG:4326","EPSG:3857");b=b.features[0].geometry;b.crs={type:"name",properties:{name:"EPSG:4326"}};var d=b.coordinates[0][0];var e=d.clone();b.coordinates[0].push(e);return b};OpenLayerMap.prototype.addPointInPolygon=function(b,e,d){var c=b.getGeometry();var a=c.getCoordinates()[0];if(a==null){a=[]}a.push(this.createLatLng(e,d));c.setCoordinates([a.clone()])};OpenLayerMap.prototype.updatePointsInPolygon=function(b,c){var d=b.getGeometry();var e=[];for(var a=0;a<c.length;a++){e.push(this.createLatLng(c[a][0],c[a][1]))}d.setCoordinates([e])};OpenLayerMap.prototype.polygonHandler=function(m,a,f,b,d,g){var h=d.getImplObject();var c=d.map;var e=m.originalEvent;var l={x:undefined,y:undefined};b.currentFence=a;var j=m.coordinate;var k=h.getCuecentEventObject(j);g.call(null,k,f,b,d,this,e.clientX,e.clientY,l.x,l.y)};OpenLayerMap.prototype.createRectangle=function(a,b,d,n,c,o){var m=[];var k=[n[0],c[1]];var j=[n[0],n[1]];var h=[c[0],n[1]];var g=[c[0],c[1]];var f=[n[0],c[1]];m.push(k,j,h,g,f);var e=new ol.geom.Polygon([m]);var l=new ol.Feature({geometry:e});l.featureType=CueGis.utils.constants.Features.FENCE;l.setStyle(this.createStyle(d));this.addFeature(l,a._layer);l.fenceType=CueGis.utils.constants.FenceType.RECTANGLE;l.draggable=d.draggable;if(o!=null){this.assignEvents(a,b,o,l,l,this.polygonHandler)}return l};OpenLayerMap.prototype.getLatLngFromRectangleFence=function(a){return this.getLatLngFromFence(a)};OpenLayerMap.prototype.enableRectangleDrawing=function(d,c,b){_this=this;var e=new ol.interaction.Draw({type:"LineString",geometryFunction:function(h,g){if(!g){g=new ol.geom.Polygon(null)}var j=h[0];var f=h[1];g.setCoordinates([[j,[j[0],f[1]],f,[f[0],j[1]],j]]);return g},maxPoints:2});c.map.addInteraction(e);this.map.addInteraction(this.drawDrag_);var a=function(g){_this.map.removeInteraction(_this.drawDrag_);var f=g.feature;f.setStyle(_this.createStyle(d.fenceOptions));_this.addFeature(f,d._layer);f.featureType=CueGis.utils.constants.Features.FENCE;f.fenceType=CueGis.utils.constants.FenceType.RECTANGLE;f.draggable=d.fenceOptions.draggable;if(d.events!=null){_this.assignEvents(d,b,d.events,f,f,_this.polygonHandler)}d.drawFence=f;d.drawFence.pId=undefined;d.drawFence.isNew=true;d.drawFence.fenceType="RECTANGLE";d.fenceList.push(d.drawFence);d.currentFence=d.drawFence;c.map.removeInteraction(e);e.un("boxend",a);c.isDrawMode=false;if(d.queryOption!=undefined){d.queryOption.callBack.call(null,d,b,c,d.currentFence)}};e.once("drawend",a);e._selfDestruct=function(){e.un("drawend",a)};this._currentDraw=e};function CuecentGISPallet(b,a){if(b===null&&a===null){console.log("palletOptions and implObject cannot be null");return null}this.container=null;this.map=null;this.selectElement=null;this.elementObjectList=[];this.zoomContainer=undefined;this.implObject=a;this._isGetLatLngMode=false;this.isDrawTextMode=false;for(var c in b){this[c]=b[c]}this.printLogs=(this.printLogs===null)?false:true;if(this.container===null||this.mapOptions===null){console.log("container and mapOptions in palletOptions cannot be null");return null}if(this.printLogs){console.log("Creating map based on mapOptions")}if(this.mapOptions){this.mapOptions.disableDefaultUI=true;this.mapOptions.zoomControl=true}this.map=this.implObject.createMap(this.container,this.mapOptions,this.mapEventHandler(this),this);var d=this;if((this.map===null||this.map===undefined)&&this.printLogs){console.log("Map Creation failed");return null}if(this.printLogs){console.log("Map Creation completed successfully")}}CuecentGISPallet.prototype.mapEventHandler=function(a){return function(b){if(a._isGetLatLngMode===true){if(a.mapClickListener!==undefined){a.mapClickListener.call(null,a.implObject.getCuecentEventObject(b.coordinate))}return}if(a.isDrawTextMode){if(a.drawTextHandler){a.drawTextHandler.call(this,b.pixel);a._drawTextPosition=b.coordinate}a.isDrawTextMode=false;return}if(a.selectElement!==null&&a.selectElement!==undefined){if(a.selectElement.mapEventHandler!==null&&a.selectElement.mapEventHandler!==undefined){if(this.printLogs){console.log("Invoking the mapEventHandler method of the currently selected Element")}a.selectElement.mapEventHandler(b,a)}}}};CuecentGISPallet.prototype.elementEventHandler=function(a,b){return function(c){if(a.selectElement!==null&&a.selectElement!==undefined){if(a.selectElement.mapCompletedEvent!==null&&a.selectElement.mapCompletedEvent!==undefined){if(this.printLogs){console.log("Invoking the mapCompletedEvent method of the previously selected Element")}a.selectElement.mapCompletedEvent(c,a)}}a.selectElement=null;if(b.eventHandler!==null&&b.eventHandler!==undefined){if(this.printLogs){console.log("Invoking the eventHandler method of the currently selected Element")}b.eventHandler(c,b)}a.selectElement=b}};CuecentGISPallet.prototype.addElement=function(c,b){c._cuecentGisPallet=this;if(this.printLogs){console.log("Adding a Element to CuecentGISPallet")}if(b===undefined){this.elementObjectList.push(c)}var a=c.getTargetElement();if(a!==null&&a!==undefined){if(this.printLogs){console.log("Adding click Event to the target Element ")}if(a.addEventListener){a.addEventListener("click",this.elementEventHandler(this,c),false)}else{if(a.attachEvent){a.attachEvent("onclick",this.elementEventHandler(this,c))}}}if(c.createLayer){c.createLayer.call(c,this)}if(c.isClusteringEnabled){c.initClusterer(this.map,this.implObject)}};CuecentGISPallet.prototype.getImplObject=function(){return this.implObject};CuecentGISPallet.prototype.setMapType=function(b){var a=this.getImplObject();a.setMapType(b)};CuecentGISPallet.prototype.stopElementSelection=function(){this.selectElement=null;if(this.implObject.isDrawMode===true){this.implObject.stopDrawing()}};CuecentGISPallet.prototype.clearElementsInMap=function(){var c=this.elementObjectList;for(var a in c){var b=c[a];if(b.clearAll){b.clearAll(this)}}};CuecentGISPallet.prototype.updateCurrentElement=function(a){if(a._cuecentGisPallet===undefined){a._cuecentGisPallet=this}if(this.selectElement!==null&&this.selectElement!==undefined){if(this.selectElement.mapCompletedEvent!==null&&this.selectElement.mapCompletedEvent!==undefined){if(this.printLogs){console.log("Invoking the mapCompletedEvent method of the previously selected Element")}this.selectElement.mapCompletedEvent(null,this)}}this.selectElement=null;if(a.eventHandler!==null&&a.eventHandler!==undefined){if(this.printLogs){console.log("Invoking the eventHandler method of the currently selected Element")}a.eventHandler(undefined,a)}this.selectElement=a};CuecentGISPallet.prototype.enableDragZoom=function(){if(this.zoomContainer){this.implObject.initDragZoom(this.zoomContainer)}};CuecentGISPallet.prototype.refreshMap=function(){this.implObject.refreshMap()};CuecentGISPallet.prototype.geoCode=function(a){this.implObject.geoDecode(a.address,a.callBack,a.limit,a.filters)};CuecentGISPallet.prototype.enableGetLatLng=function(){this._isGetLatLngMode=true};CuecentGISPallet.prototype.disableGetLatLng=function(){this._isGetLatLngMode=false};CuecentGISPallet.prototype.setMapClickListener=function(a){this.mapClickListener=a};CuecentGISPallet.prototype.reverseGeoCode=function(c,b,a){this.implObject.reverseGeoDecode({lat:c,lng:b},a)};CuecentGISPallet.prototype.fitView=function(){var b=this.map.getView().calculateExtent(this.map.getSize());var c=this.elementObjectList;var d=ol.extent.createEmpty();for(i=0;i<c.length;i++){var a=c[i];if(a.getExtent){a.getExtent(d)}}if(d.indexOf(Infinity)==-1){this.implObject.fitExtent(d,this.map.getSize())}else{console.log("Invalid Extent")}};CuecentGISPallet.prototype.focus=function(a){this.implObject.focus(a)};CuecentGISPallet.prototype.unfocus=function(a){this.implObject.unfocus(a)};CuecentGISPallet.prototype.showLayer=function(a){this.implObject.showLayer(a)};CuecentGISPallet.prototype.hideLayer=function(a){this.implObject.hideLayer(a)};CuecentGISPallet.prototype.loadBookMarks=function(a){this.implObject.loadBookMarks(a)};CuecentGISPallet.prototype.getBookMarks=function(){return this.implObject.getBookMarks()};CuecentGISPallet.prototype.getZoomLevel=function(){return this.implObject.getZoomLevel()};CuecentGISPallet.prototype.setZoomLevel=function(a){this.implObject.setZoomLevel(a)};CuecentGISPallet.prototype.setOpacity=function(a){this.implObject.updateMapOpacity(a)};CuecentGISPallet.prototype.showMap=function(){this.implObject.showMap()};CuecentGISPallet.prototype.hideMap=function(){this.implObject.hideMap()};CuecentGISPallet.prototype.updateContainer=function(a){this.implObject.updateMapContainer(a);this.refreshMap()};CuecentGISPallet.prototype.addZoomHandler=function(a){this.implObject.addZoomHandler(a)};CuecentGISPallet.prototype.removeZoomHandler=function(a){this.implObject.removeZoomHandler(a)};CuecentGISPallet.prototype.addDragHandler=function(a){this.implObject.addDragHandler(a)};CuecentGISPallet.prototype.removeDragHandler=function(a){this.implObject.removeDragHandler(a)};CuecentGISPallet.prototype.showWeather=function(){this.implObject.showWeather()};CuecentGISPallet.prototype.hideWeather=function(){this.implObject.hideWeather()};CuecentGISPallet.prototype.initPallet=function(){if(this.enablePallet){CueGis.Pallete.init(this)}};CuecentGISPallet.prototype.updatePosition=function(a){this.implObject.updateMarker(a.marker,{lat:a.lat,lng:a.lng})};function PoiElement(c,b){this.container=null;this.markerOptions={};this.eventHandler=null;this.poiList=[];this.isClusteringEnabled=false;this.clusterConfig={};this.clusterer={};this.highlightIcon=undefined;if(c===null||c===undefined){console.log("poiElementOptions cannot be null or undefined");throw"Invalid Config"}for(var a in c){this[a]=c[a]}if(this.highlightIcon===undefined){this.highlightIcon="CueGis/icons/marker32.png"}this.printLogs=(this.printLogs===null)?false:true;this._layer=undefined;this._clusterLayer=undefined;if(b){this._cuecentGisPallet=b;b.addElement(this)}}PoiElement.prototype.mapEventHandler=function(e,a){var c=a.getImplObject();var d=c.getLatLngFromEvent(e);var b=c.createMarker(this,a,this.markerOptions,d[0],d[1],this.events);b.isNew=true;b.pId=undefined;b.metaData=undefined;this.addPoiToList(b,c);if(this.dropCallBack&&typeof this.dropCallBack=="function"){this.dropCallBack.call(this,b)}};PoiElement.prototype.initClusterer=function(c,a){var b={};if(this.clusterConfig){if(this.clusterConfig.imagePath){b.imagePath=this.clusterConfig.imagePath}if(this.clusterConfig.callBack){b.clustererCallBack=this.clusterConfig.callBack}if(this.clusterConfig.fillColor){b.fillColor=this.clusterConfig.fillColor}else{b.fillColor="#3399CC"}if(this.clusterConfig.strokeColor){b.strokeColor=this.clusterConfig.strokeColor}else{b.strokeColor="#fff"}}else{b.fillColor="#3399CC";b.strokeColor="#fff"}if(this.clusterEvents){b.events=this.clusterEvents}this.clusterer=a.createMarkerClusterer(b);this._clusterLayer=this.clusterer;this._clustererSrc=this.clusterer._source};PoiElement.prototype.updateMarkerOption=function(a){for(var b in a){if(a.hasOwnProperty(b)){this.markerOptions[b]=a[b]}}};PoiElement.prototype.getTargetElement=function(){return this.container};PoiElement.prototype.addPoiToList=function(b,a,c){this.poiList.push(b);if(this.isClusteringEnabled&&this.clusterer){a.addMarker(this.clusterer,b,this._clustererSrc,c)}};PoiElement.prototype.getLatLngFromMarker=function(c,a){var b=a.getImplObject();return b.getLatLngFromMarker(c)};PoiElement.prototype.loadPOI=function(e,a){if(!a||!e){throw"Argument is missing"}var c=a.getImplObject();var d=this.markerOptions;var b=c.createMarker(this,a,e.markerOptions,e.latitude,e.longitude,this.events);if(e.isNew!==undefined){b.isNew=e.isNew}else{b.isNew=false}b.pId=e.pId;b.metaData=e.metaData;this.addPoiToList(b,c,e.isBulkLoading);if(e.refHolder){e.refHolder.push(b)}if(e.toolTip!==undefined&&e.toolTip!==null){c.createDisplay(b,e.toolTip)}if(e.pan){c.panTo(e.latitude,e.longitude)}return b};PoiElement.prototype.loadPOIAtAddress=function(e,a){if(!a||!e){throw"Argument is missing"}var c=a.getImplObject();var d=this.markerOptions;if(e.markerOptions!==undefined&&e.markerOptions!==null){d=e.markerOptions}var b;if(e.address){var f=this;c.geoDecode(e.address,function(j,g){if(g=="OK"){for(var h=0;h<j.length;h++){f.loadPOI({latitude:j[h].lat,longitude:j[h].lng,markerOptions:e.markerOptions,name:e.name,isNew:true,pId:e.pId,pan:e.pan,toolTip:j[h].name,refHolder:e.refHolder},a)}}else{throw g}})}};PoiElement.prototype.removePOI=function(b,d){var a=this._cuecentGisPallet.getImplObject();var c=-1;for(var f=0;f<this.poiList.length;f++){if(b===this.poiList[f]){c=f;break}}if(b._isFocussed&&b._highlightType=="animation"){this.unHighlight(b)}if(c!=-1){try{a.removeMarker(b,this)}catch(g){console.log(g)}this.poiList.splice(c,1);if(this.isClusteringEnabled&&this.clusterer&&!d){a.clearClusterMarker(this.clusterer,b)}return true}else{if(this.printLogs){console.log("Marker not found")}return false}};PoiElement.prototype.clearAll=function(b){var a=b.getImplObject();while(this.poiList.length!==0){var c=this.poiList[0];this.removePOI(c,true)}if(this.isClusteringEnabled){this._clusterLayer.getSource().getSource().clear(true)}};PoiElement.prototype.getPoiList=function(){return this.poiList};PoiElement.prototype.getNewPoiElements=function(){var b=this.poiList;var c=[];for(var a=0;a<b.length;a++){if(b[a].isNew){c.push(b[a])}}return c};PoiElement.prototype.getPointBuffer=function(b){var c={};c.type="Polygon";var h={};h.type="name";h.properties={name:"EPSG:4326"};c.crs=h;var f;b.radius=b.radius/((Math.PI/180)*6378137);var d=new jsts.geom.Coordinate(b.lat,b.lng);var j=new jsts.geom.GeometryFactory();var g=j.createPoint(d);f=g.buffer(b.radius,180,1);f=f.getCoordinates();c.coordinates=[];c.coordinates.push(CueGis.utils.GeoJsonUtils.getCoordinatesArray(f));var a=c.coordinates[0][0];var e=a.clone();c.coordinates[0].push(e);return c};PoiElement.prototype.highlight=function(c,b){var a=this._cuecentGisPallet.getImplObject();a.focus(c,this,b)};PoiElement.prototype.unHighlight=function(b){var a=this._cuecentGisPallet.getImplObject();a.unfocus(b)};PoiElement.prototype.getExtent=function(c){for(var a=0;a<this.poiList.length;a++){var e=this.poiList[a];var d=e.getGeometry();var b=d.getExtent();ol.extent.extend(c,b)}};PoiElement.prototype.hidePOI=function(b){var a=this._cuecentGisPallet.getImplObject();var c=-1;for(var d=0;d<this.poiList.length;d++){if(b===this.poiList[d]){c=d;break}}if(b._isFocussed&&b._highlightType=="animation"){this.unHighlight(b)}if(c!=-1){a.removeMarker(b,this);if(this.isClusteringEnabled&&this.clusterer){a.clearClusterMarker(this.clusterer,b)}b.isHidden=true;return b}else{if(this.printLogs){console.log("Marker not found")}return false}};PoiElement.prototype.hideAll=function(){this.hideLayer()};PoiElement.prototype.showPOI=function(b){var a=this._cuecentGisPallet.getImplObject();var c=-1;for(var d=0;d<this.poiList.length;d++){if(b===this.poiList[d]){c=d;break}}if(c!=-1){if(this.isClusteringEnabled&&this.clusterer){a.addMarker(this.clusterer,b)}else{a.enableMarker(b,this)}b.isHidden=false;return true}else{if(this.printLogs){console.log("Marker not found")}return false}};PoiElement.prototype.showAll=function(){this.showLayer()};PoiElement.prototype.createLayer=function(a){this._layer=a.implObject.createFeatureContainer();a.map.addLayer(this._layer)};PoiElement.prototype.showLayer=function(){this._cuecentGisPallet.implObject.showLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.showLayer(this._clusterLayer)}var c=this.poiList;for(var b=0;b<c.length;b++){var a=c[b];a.isHidden=false}};PoiElement.prototype.hideLayer=function(){this._cuecentGisPallet.implObject.hideLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.hideLayer(this._clusterLayer)}var c=this.poiList;for(var b=0;b<c.length;b++){var a=c[b];a.isHidden=true}};PoiElement.prototype.setOpacity=function(a){this._cuecentGisPallet.implObject.updateOpacity(this._layer,a);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.updateOpacity(this._clusterLayer,a)}};PoiElement.prototype.getOpacity=function(){return this._cuecentGisPallet.implObject.getOpacity(this._layer)};PoiElement.prototype.pan=function(a,b){this._cuecentGisPallet.implObject.panPOI(a);if(b===true){this._cuecentGisPallet.implObject.fitGeometryInMap(a.getGeometry())}};PoiElement.prototype._centerObserve=function(){var a=this;return function(){var c=[];var f=a._cuecentGisPallet.map;var b=f.getView().calculateExtent(f.getSize());if(a._isObserve){var e=a.poiList;for(var d=0;d<e.length;d++){var g=e[d];if(ol.extent.containsCoordinate(b,g.getGeometry().getCoordinates())){c.push(g)}}a._observeCallBack.call(null,c)}}};PoiElement.prototype.startObserve=function(a){this._observeCallBack=a;this._isObserve=true;this._cuecentGisPallet.implObject._baseView.on("change:center",this._centerObserve());this._cuecentGisPallet.implObject._baseView.on("change:resolution",this._centerObserve())};PoiElement.prototype.stopObserve=function(){this._isObserve=false;this._cuecentGisPallet.implObject._baseView.un("change:center",this._centerObserve);this._cuecentGisPallet.implObject._baseView.un("change:resolution",this._zoomObserve)};PoiElement.prototype.getPoiLocation=function(a){return this._cuecentGisPallet.implObject.getPoiPosition(a)};PoiElement.prototype.setDropCallBack=function(a){this.dropCallBack=a};PoiElement.prototype.isDropCallBackEnabled=function(){if(typeof this.dropCallBack=="function"){return true}return false};PoiElement.prototype.loadPOIs=function(d){var b=[];var a=d.items;var f=d.callBack;for(var c=0;c<a.length;c++){var e=a[c];e.isBulkLoading=true;var g=this.loadPOI(e,this._cuecentGisPallet);if(f){f.call(null,g)}b.push(g)}this._clusterLayer.getSource().getSource().addFeatures(b);if(d.fitView){this._cuecentGisPallet.fitView()}};PoiElement.prototype.updateIcon=function(g,e,c,f){var a=this._cuecentGisPallet.getImplObject();var d=a.updateMarkerIcon(g,e,c,f);if(this.isClusteringEnabled&&this.clusterer){var b=this.clusterer.markerList.indexOf(g);this.clusterer.markerStyleList[b]=d}};function FencingElement(b){this.container=null;this.fenceOptions=null;this.fenceList=[];this.currentFence=null;this.drawFence=null;this.drawMode=2;this.fenceRadius=10000;this.fenceHeight=1000;this.fenceWidth=1000;this.queryOption=undefined;this.fenceType="POLYGON";this.poiList=[];this.clusterer=undefined;this._layer=undefined;this._clusterLayer=undefined;if(b==null){console.log("fencingElementOptions cannot be null");return null}this.metricConfig=undefined;for(var a in b){this[a]=b[a]}this.printLogs=(this.printLogs==null)?false:true;if(this.container==null&&b==null){console.log("container/fenceOptions cannot be null");return null}}FencingElement.prototype.getTargetElement=function(){return this.container};FencingElement.prototype.mapEventHandler=function(d,a){var b=a.getImplObject();var c=b.getLatLngFromEvent(d);if(this.drawMode==1){this._defaultDrawing(d,a,b,c)}};FencingElement.prototype.eventHandler=function(b,c){var a=this._cuecentGisPallet.getImplObject();if(this.drawMode==2){if(a.enableDrawing==undefined){return}a.enableDrawing(this,a,this._cuecentGisPallet);a.isDrawMode=true}};FencingElement.prototype.updateQueryOptions=function(a){this.queryOption=a};FencingElement.prototype._defaultDrawing=function(e,b,c,d){if(this.fenceType=="POLYGON"){if(this.drawFence==null||this.drawFence==undefined||this.drawFence.fenceType!="POLYGON"){this.drawFence=c.createPolygon(this,b,this.fenceOptions,this.events);this.drawFence.fenceType="POLYGON";this.fenceList.push(this.drawFence);this.currentFence=this.drawFence}c.addPointInPolygon(this.drawFence,d[0],d[1])}else{if(this.fenceType=="CIRCLE"){var a=c.createLatLng(d[0],d[1]);if(!this.events){this.events={}}this.drawFence=c.createCircle(this,b,this.fenceOptions,a,this.fenceRadius,this.events);this.drawFence.fenceType="CIRCLE";this.fenceList.push(this.drawFence);this.currentFence=this.drawFence}else{if(this.fenceType=="RECTANGLE"){this.drawFence=c.createRectangle(this,b,this.fenceOptions,c.createLatLng(d[0]+0.1,d[1]-0.1),c.createLatLng(d[0]-0.1,d[1]+0.1),this.events);this.drawFence.fenceType="RECTANGLE";this.fenceList.push(this.drawFence);this.currentFence=this.drawFence}}}this.drawFence.isNew=true;this.drawFence.pId=undefined};FencingElement.prototype.mapCompletedEvent=function(b,a){this.drawFence=null;this.currentFence=null};FencingElement.prototype.updateDrawMode=function(a){a=a.toLowerCase();if(a=="default"){this.drawMode=1}else{if(a=="freehand"){this.drawMode=2}else{throw"Invalid Draw Mode, Possible values are Default or FreeHand"}}};FencingElement.prototype.updateFenceOptions=function(a){this.fenceOptions=a};FencingElement.prototype.updateFenceRadius=function(a){this.fenceRadius=a};FencingElement.prototype.updateRectangleFenceDimension=function(a,b){this.fenceHeight=a;this.fenceWidth=b};FencingElement.prototype.load=function(a){var c=a.geoJson.coordinates;if(a.config.isPoiFence||a.type=="CIRCLE"){var g=new jsts.geom.GeometryFactory();var q=new jsts.geom.Envelope();var t=g.createPolygon(q,null)}var b=this;var f=a.cuecentGISPallet;var e;var p=f.getImplObject();if(c!=null){var s=c[0];var j=[];for(var k=0;k<s.length;k++){var l=[];l[0]=s[k][1];l[1]=s[k][0];if(a.config.isPoiFence||a.type=="CIRCLE"){var n=new jsts.geom.Coordinate(l[0],l[1]);q.expandToIncludeCoordinate(n)}j.push(l)}if(a.config.isPoiFence){a.config.fenceOptions={};a.config.fenceOptions.editable=false;a.config.fenceOptions.draggable=false;a.config.fenceOptions.fillColor=b.fenceOptions.fillColor;a.config.fenceOptions.fillOpacity=0.5}if(a.type=="RECTANGLE"){e=b.loadRectangleFence(a.config.fenceId,j,a.config.fenceOptions,a.config.toolTip,a.config.pan,f,a.config.isPoiFence)}else{if(a.type=="CIRCLE"){var o=t.shell.centre();var r=p.createLatLng(o.x,o.y);var d=t.shell.getHeight();d=d/2;d=d*((Math.PI/180)*6378137);e=b.loadCircleFence(a.config.fenceId,r,d,a.config.fenceOptions,a.config.toolTip,a.config.pan,f,a.config.isPoiFence)}else{e=b.loadFence(a.config.fenceId,j,a.config.fenceOptions,a.config.toolTip,a.config.pan,f,a.config.isPoiFence)}}e.isNew=!!a.config.isNew;if(a.config.isPoiFence){if(a.config.hideFence==true){p.removePolygon(b.currentFence)}e.isPoiFence=true;var o=t.shell.centre();var m=g.createPoint(o);var h=undefined;h=p.createMarker(this,f,{title:a.config.fenceName,draggable:false},o.x,o.y,null);e.poi=h;b.poiList.push(h);if(b.isClusteringEnabled&&b.clusterer){p.addMarker(this.clusterer,h,true)}}}return e};FencingElement.prototype.loadFence=function(c,g,e,a,h,b){if(e==undefined||e==null){e=this.fenceOptions}var d=b.getImplObject();var j=d.createPolygon(this,b,e,this.events);j.fenceId=c;j.fenceType="POLYGON";this.currentFence=j;for(var f=1;f<g.length;f++){d.addPointInPolygon(j,g[f][0],g[f][1])}if(a){d.createDisplay(j,a,true)}this.fenceList.push(j);if(h){d.panTo(g[0][0],g[0][1])}return j};FencingElement.prototype.loadRectangleFence=function(e,h,d,c,g,a){var b=a.getImplObject();if(d==undefined||d==null){d=this.fenceOptions}var f=b.createRectangle(this,a,d,b.createLatLng(h[1][0],h[1][1]),b.createLatLng(h[3][0],h[3][1]),this.events);f.fenceId=e;f.fenceType="RECTANGLE";this.currentFence=f;if(c){b.createDisplay(f,c,true)}this.fenceList.push(f);if(g){b.panTo(h[0][0],h[0][1])}return f};FencingElement.prototype.loadCircleFence=function(d,b,g,f,a,h,c){if(f==undefined||f==null){f=this.fenceOptions}var e=c.getImplObject();var j=e.createCircle(this,c,f,b,g,this.events);j.fenceId=d;j.fenceType="CIRCLE";this.currentFence=j;if(a!=undefined){e.createDisplay(j,a,true)}this.fenceList.push(j);if(h){var b=e.getFenceCenter(j);e.panTo(b.lat,b.lng)}return j};FencingElement.prototype.getLatLngFromFence=function(c,a){var b=a.getImplObject();if(c.fenceType=="RECTANGLE"){return b.getLatLngFromRectangleFence(c)}else{if(c.fenceType=="CIRCLE"){return b.getLatLngFromCircularFence(c)}else{return b.getLatLngFromFence(c)}}};FencingElement.prototype.updateFenceType=function(a){this.fenceType=a};FencingElement.prototype.removeFence=function(e){var a=this._cuecentGisPallet.getImplObject();var b=-1;for(var c=0;c<this.fenceList.length;c++){if(e===this.fenceList[c]){b=c;break}}if(b!=-1){if(e.measureElement){a.removeFenceDistanceElement(e.measureElement);if(e.radiusLine){a.removePolyLine(e.radiusLine,this)}}a.removePolygon(e,this);if(e.isPoiFence){var d=e.poi;a.removeMarker(d,this);if(this.isClusteringEnabled!=undefined&&this.isClusteringEnabled==true){if(this.clusterer!=undefined){a.clearClusterMarker(this.clusterer,d)}}this.poiList.splice(0,1)}this.fenceList.splice(b,1);return true}else{if(this.printLogs){console.log("fence not found")}return false}};FencingElement.prototype.initClusterer=function(c,a){var b={};if(this.clusterConfig){if(this.clusterConfig.imagePath){b.imagePath=this.clusterConfig.imagePath}if(this.clusterConfig.callBack){b.clustererCallBack=this.clusterConfig.callBack}}this.clusterer=a.createMarkerClusterer(c,this.poiList,b);this._clusterLayer=this.clusterer};FencingElement.prototype.exportGeoJson=function(c,b){var a=this.exportGeoJsonObject(c,b);return JSON.stringify(a)};FencingElement.prototype.exportGeoJsonObject=function(d,b){var c=b.getImplObject();var a=undefined;if(d.fenceType=="RECTANGLE"){a=c.getLatLngFromRectangleFence(d)}else{if(d.fenceType=="CIRCLE"){a=c.getLatLngFromCircularFence(d)}else{a=c.getLatLngFromFence(d)}}return a};FencingElement.prototype.clearAll=function(b){var a=b.getImplObject();while(this.fenceList.length!=0){this.removeFence(this.fenceList[0])}};FencingElement.prototype.getRadius=function(b,c){if(b.fenceType!="CIRCLE"){throw"Invalid request for this type of fence"}var a=c.getImplObject();return a.getRadius(b)};FencingElement.prototype.getDrawMode=function(){if(this.drawMode==1){return"DEFAULT"}if(this.drawMode==2){return"FREEHAND"}};FencingElement.prototype.getFenceCenter=function(a){return this._cuecentGisPallet.getImplObject().getFenceCenter(a)};FencingElement.prototype.getFenceList=function(){return this.fenceList};FencingElement.prototype.getNewFenceElements=function(){var c=this.fenceList;var a=[];for(var b=0;b<c.length;b++){if(c[b].isNew){a.push(c[b])}}return a};FencingElement.prototype.getArea=function(b){var c=b.fence;if(c==undefined){c=this.currentFence}var a=this._cuecentGisPallet.getImplObject();return a.getAreaForFence(c,b.unit,b.calcType)};FencingElement.prototype.updateMetricConfig=function(a){this.metricConfig=a};FencingElement.prototype.getExtent=function(b){for(var a=0;a<this.fenceList.length;a++){var e=this.fenceList[a];var d=e.getGeometry();var c=d.getExtent();ol.extent.extend(b,c)}};FencingElement.prototype.highLightFence=function(c,b){var a=this._cuecentGisPallet.getImplObject();a.highLightFence(c,b)};FencingElement.prototype.UnHighLightFence=function(b){var a=this._cuecentGisPallet.getImplObject();a.UnHighLightFence(b)};FencingElement.prototype.showFence=function(e){var b=this._cuecentGisPallet.getImplObject();var c=-1;var a={};for(var d=0;d<this.fenceList.length;d++){if(e===this.fenceList[d]){c=d;break}}if(c!=-1){e.isHidden=false;b.addPolygonFeature(e,this)}};FencingElement.prototype.showAll=function(){this.showLayer()};FencingElement.prototype.HideAll=function(){this.hideLayer()};FencingElement.prototype.hideFence=function(e){var a=this._cuecentGisPallet.getImplObject();var b=-1;for(var c=0;c<this.fenceList.length;c++){if(e===this.fenceList[c]){b=c;break}}if(b!=-1){e.isHidden=true;if(e.measureElement){a.removeFenceDistanceElement(e.measureElement);if(e.radiusLine){a.removePolyLine(e.radiusLine,this)}}a.removePolygon(e,this);if(e.isPoiFence){var d=e.poi;a.removeMarker(d,this);if(this.isClusteringEnabled!=undefined&&this.isClusteringEnabled==true){if(this.clusterer!=undefined){a.clearClusterMarker(this.clusterer,d)}}}return e}else{if(this.printLogs){console.log("fence not found")}return false}};FencingElement.prototype.createLayer=function(a){this._layer=a.implObject.createFeatureContainer();a.map.addLayer(this._layer)};FencingElement.prototype.showLayer=function(){this._cuecentGisPallet.implObject.showLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.showLayer(this._clusterLayer)}var a=this.fenceList;for(var b=0;b<a.length;b++){var d=a[b];d.isHidden=false;if(this.metricConfig){if(d.measureElement){d.measureElement.toolTipDiv.style.display="block"}if(d.toolTips!=undefined){for(var c=0;c<d.toolTips.length;c++){d.toolTips[c].toolTipDiv.style.display="block"}}}}};FencingElement.prototype.hideLayer=function(){this._cuecentGisPallet.implObject.hideLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.hideLayer(this._clusterLayer)}var a=this.fenceList;for(var b=0;b<a.length;b++){var d=a[b];d.isHidden=true;if(this.metricConfig){if(d.measureElement){d.measureElement.toolTipDiv.style.display="none"}if(d.toolTips!=undefined){for(var c=0;c<d.toolTips.length;c++){d.toolTips[c].toolTipDiv.style.display="none"}}}}};FencingElement.prototype.setOpacity=function(b){this._cuecentGisPallet.implObject.updateOpacity(this._layer,b);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.updateOpacity(this._clusterLayer,b)}if(this.metricConfig){var a=this.fenceList;for(var c=0;c<a.length;c++){var e=a[c];if(e.measureElement){e.measureElement.toolTipDiv.style.opacity=b}if(e.toolTips!=undefined){for(var d=0;d<e.toolTips.length;d++){e.toolTips[d].toolTipDiv.style.opacity=b}}}}};FencingElement.prototype.getOpacity=function(){return this._cuecentGisPallet.implObject.getOpacity(this._layer)};FencingElement.prototype.pan=function(a,b){this._cuecentGisPallet.implObject.panFence(a);if(b==true){this._cuecentGisPallet.implObject.fitGeometryInMap(a.getGeometry())}};function TrackingElement(b){this.container==null;this.markerOptions={};this.eventHandler=null;this.trackingElementList=[];this.currentEvent=null;this.highlightIcon=undefined;this.isClusteringEnabled=false;this.clusterer={};this.clusterConfig={};this._layer=undefined;this._clusterLayer=undefined;if(b==null||b==undefined){console.log("trackingElementOptions cannot be null or undefined");return null}for(var a in b){this[a]=b[a]}if(this.highlightIcon==undefined){this.highlightIcon="CueGis/icons/marker32.png"}this.printLogs=(this.printLogs==null)?false:true;if(this.container==null&&this.markerOptions==null){console.log("container/markerOptions cannot be null");return null}}TrackingElement.prototype.initClusterer=function(c,a){var b={};if(this.clusterConfig){if(this.clusterConfig.imagePath){b.imagePath=this.clusterConfig.imagePath}if(this.clusterConfig.callBack){b.clustererCallBack=this.clusterConfig.callBack}if(this.clusterConfig.fillColor){b.fillColor=this.clusterConfig.fillColor}else{b.fillColor="#3399CC"}if(this.clusterConfig.strokeColor){b.strokeColor=this.clusterConfig.strokeColor}else{b.strokeColor="#fff"}}else{b.fillColor="#3399CC";b.strokeColor="#fff"}if(this.clusterEvents){b.events=this.clusterEvents}this.clusterer=a.createMarkerClusterer(b);this._clusterLayer=this.clusterer;this._clustererSrc=this.clusterer._source};TrackingElement.prototype.updateMarkerOption=function(a){this.markerOptions=a};TrackingElement.prototype.getTargetElement=function(){return this.container};TrackingElement.prototype.createEvent=function(d,a){var b=a.getImplObject();var c=this.markerOptions;if(d.markerOptions!=undefined&&d.markerOptions!=null){c=d.markerOptions}var e=b.createMarker(this,a,c,d.latitude,d.longitude,this.events);e.pId=d.eventId;e.metaData=d.metaData;this.addEventsToList(e,b,d.isBulkLoading);if(d.toolTip!=undefined&&d.toolTip!=null){b.createDisplay(e,d.toolTip)}if(d.pan){b.panTo(d.latitude,d.longitude)}return e};TrackingElement.prototype.loadTrackingElement=function(b,a){return this.createEvent(b,a)};TrackingElement.prototype.addEventsToList=function(b,a,c){this.trackingElementList.push(b);if(this.isClusteringEnabled&&this.clusterer){a.addMarker(this.clusterer,b,this._clustererSrc,c)}};TrackingElement.prototype.getLatLngFromMarker=function(c,a){var b=a.getImplObject();return b.getLatLngFromMarker(c)};TrackingElement.prototype.remove=function(e,c){var a=this._cuecentGisPallet.getImplObject();var b=-1;for(var d=0;d<this.trackingElementList.length;d++){if(e===this.trackingElementList[d]){b=d;break}}if(b!=-1){if(e.route!=undefined){a.removePolyLine(e.route,this)}a.removeMarker(e,this);this.trackingElementList.splice(b,1);if(this.isClusteringEnabled&&this.clusterer&&!c){a.clearClusterMarker(this.clusterer,e)}return true}else{if(this.printLogs){console.log("Tracking Element not found")}return false}};TrackingElement.prototype.loadRoute=function(c){if(c.geoJson==undefined){console.error("GeoJSON is missing");return}var a=this._cuecentGisPallet.getImplObject();if(c.routeOptions&&c.routeOptions.lineDash==undefined){c.routeOptions.lineDash=[1,10]}var b=a.createPolyLine(c.routeOptions,this,this._cuecentGisPallet,c.events);var e=c.geoJson.coordinates;for(var f=0;f<e.length;f++){var d=e[f];a.addPointInPolyLine(b,d[1],d[0])}c.trackingElement.route=b};TrackingElement.prototype.clearAll=function(b){var a=b.getImplObject();while(this.trackingElementList.length!=0){this.remove(this.trackingElementList[0],true)}this._clusterLayer.getSource().getSource().clear(true)};TrackingElement.prototype.highlight=function(c,b){var a=this._cuecentGisPallet.getImplObject();a.focus(c,this,b)};TrackingElement.prototype.unHighlight=function(b){var a=this._cuecentGisPallet.getImplObject();a.unfocus(b)};TrackingElement.prototype.getExtent=function(e){for(var a=0;a<this.trackingElementList.length;a++){var c=this.trackingElementList[a];var d=c.getGeometry();var b=d.getExtent();ol.extent.extend(e,b)}};TrackingElement.prototype.hidePOI=function(b){var a=this._cuecentGisPallet.getImplObject();var c=-1;for(var d=0;d<this.trackingElementList.length;d++){if(b===this.trackingElementList[d]){c=d;break}}if(b._isFocussed&&b._highlightType=="animation"){this.unHighlight(b)}if(c!=-1){a.removeMarker(b,this);if(this.isClusteringEnabled&&this.clusterer){a.clearClusterMarker(this.clusterer,b)}b.isHidden=true;return b}else{if(this.printLogs){console.log("Marker not found")}return false}};TrackingElement.prototype.hideAll=function(){this.hideLayer()};TrackingElement.prototype.showPOI=function(b){var a=this._cuecentGisPallet.getImplObject();var c=-1;for(var d=0;d<this.trackingElementList.length;d++){if(b===this.trackingElementList[d]){c=d;break}}if(c!=-1){a.addMarker(this.clusterer,b);b.isHidden=false;return true}else{if(this.printLogs){console.log("Marker not found")}return false}};TrackingElement.prototype.showAll=function(){this.showLayer()};TrackingElement.prototype.createLayer=function(a){this._layer=a.implObject.createFeatureContainer();a.map.addLayer(this._layer)};TrackingElement.prototype.showLayer=function(){this._cuecentGisPallet.implObject.showLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.showLayer(this.clusterer)}var c=this.trackingElementList;for(var b=0;b<c.length;b++){var a=c[b];a.isHidden=false}};TrackingElement.prototype.hideLayer=function(){this._cuecentGisPallet.implObject.hideLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.hideLayer(this.clusterer)}var c=this.trackingElementList;for(var b=0;b<c.length;b++){var a=c[b];a.isHidden=true}};TrackingElement.prototype.setOpacity=function(a){this._cuecentGisPallet.implObject.updateOpacity(this._layer,a);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.updateOpacity(this.clusterer,a)}};TrackingElement.prototype.getOpacity=function(){return this._cuecentGisPallet.implObject.getOpacity(this._layer)};TrackingElement.prototype.pan=function(a,b){this._cuecentGisPallet.implObject.panPOI(a);if(b==true){this._cuecentGisPallet.implObject.fitGeometryInMap(a.getGeometry())}};TrackingElement.prototype._centerObserve=function(){var a=this;return function(){var c=[];var f=a._cuecentGisPallet.map;var b=f.getView().calculateExtent(f.getSize());if(a._isObserve){var e=a.trackingElementList;for(var d=0;d<e.length;d++){var g=e[d];if(ol.extent.containsCoordinate(b,g.getGeometry().getCoordinates())){c.push(g)}}a._observeCallBack.call(null,c)}}};TrackingElement.prototype.startObserve=function(a){this._observeCallBack=a;this._isObserve=true;this._cuecentGisPallet.implObject._baseView.on("change:center",this._centerObserve());this._cuecentGisPallet.implObject._baseView.on("change:resolution",this._centerObserve())};TrackingElement.prototype.stopObserve=function(){this._isObserve=false;this._cuecentGisPallet.implObject._baseView.un("change:center",this._centerObserve);this._cuecentGisPallet.implObject._baseView.un("change:resolution",this._centerObserve)};TrackingElement.prototype.loadTrackingElements=function(d){var b=[];var a=d.items;var f=d.callBack;for(var c=0;c<a.length;c++){var e=a[c];e.isBulkLoading=true;var g=this.loadTrackingElement(e,this._cuecentGisPallet);if(f){f.call(null,g)}b.push(g)}this._clusterLayer.getSource().getSource().addFeatures(b);if(d.fitView){this._cuecentGisPallet.fitView()}};TrackingElement.prototype.updateIcon=function(g,e,c,f){var a=this._cuecentGisPallet.getImplObject();var d=a.updateMarkerIcon(g,e,c,f);if(this.isClusteringEnabled&&this.clusterer){var b=this.clusterer.markerList.indexOf(g);this.clusterer.markerStyleList[b]=d}};TrackingElement.prototype.updateMetadata=function(b,a){if(b!==undefined){b.metaData=a}};function LineBufferElement(b){if(b==null){console.log("lineBufferElementOptions cannot be null");return null}for(var a in b){this[a]=b[a]}this.printLogs=(this.printLogs==null)?false:true;if(this.container==null&&b==null){console.log("container/fenceOptions cannot be null");return null}this.lineBuffer=null;this.lineBufferList=[];this._layer=undefined;this.setDefaultUIProperties()}LineBufferElement.prototype.setDefaultUIProperties=function(){if(this.lineOptions==undefined){this.lineOptions={};this.lineOptions.strokeColor="RED";this.lineOptions.strokeOpacity=0.6;this.lineOptions.strokeWeight=3}this.lineOptions.draggable=false;this.lineOptions.editable=false;if(this.bufferOptions==undefined){this.bufferOptions={};this.bufferOptions.strokeColor="GREEN";this.bufferOptions.strokeOpacity=0.6;this.bufferOptions.strokeWeight=1}this.bufferOptions.draggable=false;this.bufferOptions.editable=false};LineBufferElement.prototype.updateLineBufferOptions=function(a){this.lineBufferOptions=a};LineBufferElement.prototype.updateLineOptions=function(a){this.lineOptions=a;this.lineOptions.draggable=false;this.lineOptions.editable=false};LineBufferElement.prototype.updateBufferOptions=function(a){this.bufferOptions=a;this.bufferOptions.draggable=false;this.bufferOptions.editable=false};LineBufferElement.prototype.updateLineBufferWidth=function(a){this.bufferWidth=a};LineBufferElement.prototype.getTargetElement=function(){return this.container};LineBufferElement.prototype.mapEventHandler=function(d,a){var b=a.getImplObject();var c=b.getLatLngFromEvent(d);if(this.lineBuffer==null){this.lineBuffer={};this.lineBuffer.line=b.createPolyLine(this.lineOptions,this,a,this.events);this.lineBuffer.buffer=b.createPolygon(this,a,this.bufferOptions,this.events);this.lineBufferList.push(this.lineBuffer)}b.addPointInPolyLine(this.lineBuffer.line,c[0],c[1]);this.refreshCurrentPolygon(b)};LineBufferElement.prototype.mapCompletedEvent=function(b,a){this.lineBuffer=null};LineBufferElement.prototype.removeLineBuffer=function(b){var a=this._cuecentGisPallet.getImplObject();var c=-1;var d=undefined;for(i=0;i<this.lineBufferList.length;i++){if(b===this.lineBufferList[i].buffer){d=this.lineBufferList[i];c=i}}if(c!=-1){a.removePolyLine(d.line,this);a.removePolygon(d.buffer,this);this.lineBufferList.splice(c,1);return true}else{if(this.printLogs){console.log("Line Buffer not found")}return false}};LineBufferElement.prototype.exportAsGeoJson=function(c,g){var b=c||this.bufferWidth||100;b=b/((Math.PI/180)*6378137);var d=undefined;for(i=0;i<this.lineBufferList.length;i++){if(g===this.lineBufferList[i].buffer){d=this.lineBufferList[i];index=i}else{if(g==this.lineBufferList[i].line){console.log("Line was clicked");d=this.lineBufferList[i];index=i}}}if(d==undefined){return}this.lineBuffer=d;var l=this._cuecentGisPallet.getImplObject().getLatLngFromPolyline(this.lineBuffer.line);var f=[];for(pIndex=0;pIndex<l.length;pIndex++){var m=l[pIndex];f.push(new jsts.geom.Coordinate(m[0],m[1]))}var n=new jsts.geom.GeometryFactory();var h=n.createLineString(f);var a=h.buffer(b,4,1);var k=a.getCoordinates();try{return JSON.stringify(CueGis.utils.GeoJsonUtils.generateGeoJsonForPolygon(k))}catch(j){throw"Invalid coordinated from line buffer"}};LineBufferElement.prototype.refreshCurrentPolygon=function(d){var b=this.bufferWidth||100;b=b/((Math.PI/180)*6378137);var h=d.getLatLngFromPolyline(this.lineBuffer.line);var c=[];for(pIndex=0;pIndex<h.length;pIndex++){c.push(new jsts.geom.Coordinate(h[pIndex][0],h[pIndex][1]))}var j=new jsts.geom.GeometryFactory();var f=j.createLineString(c);var a=f.buffer(b,4,1);var g=a.getCoordinates();var e=[];for(i=0;i<g.length;i++){e.push([g[i].x,g[i].y])}d.updatePointsInPolygon(this.lineBuffer.buffer,e)};LineBufferElement.prototype.clearAll=function(){while(this.lineBufferList.length!=0){var a=this.lineBufferList[0];this.removeLineBuffer(a.buffer)}};LineBufferElement.prototype.getLineGeoJson=function(){var a=this._cuecentGisPallet.getImplObject().getLatLngsFromPolyLine(this.lineBuffer.line);return a};LineBufferElement.prototype.getExtent=function(e){for(var a=0;a<this.lineBufferList.length;a++){var c=this.lineBufferList[a];var d=c.buffer.getGeometry();var b=d.getExtent();ol.extent.extend(e,b)}};LineBufferElement.prototype.createLayer=function(a){this._layer=a.implObject.createFeatureContainer();a.map.addLayer(this._layer)};LineBufferElement.prototype.showLayer=function(){this._cuecentGisPallet.implObject.showLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.showLayer(this._clusterLayer)}};LineBufferElement.prototype.hideLayer=function(){this._cuecentGisPallet.implObject.hideLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.hideLayer(this._clusterLayer)}};LineBufferElement.prototype.setOpacity=function(a){this._cuecentGisPallet.implObject.updateOpacity(this._layer,a);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.updateOpacity(this._clusterLayer,a)}};LineBufferElement.prototype.getOpacity=function(){return this._cuecentGisPallet.implObject.getOpacity(this._layer)};function RouteElement(b){this.drawnRoutes=[];this.currentRoute=null;this.eventHandler=null;this.points=[];this._layer=undefined;for(var a in b){this[a]=b[a]}this._directionIcon="CueGis/icons/arrowD.png";this._defaultRouteOption={useRouteFinder:false,strokeColor:"#8000FF",strokeWidth:3,showDirection:false,fitView:true}}RouteElement.prototype.findRoute=function(c,b){var e=b.getImplObject();var h=c.locations||[];var d=c.callBack||function(){};var k=c.type||"findRoute";if(h.length<2){throw"Atleast two locations are required"}var a=h[0];var l=h[h.length-1];var j=[];if(h.length>2){for(var f=1;f<(h.length-1);f++){j.push({location:h[f]})}}var g={source:a,destination:l,wayPoints:j,getSingleResult:true,type:k};e.findRoute(g,function(m){d.call(null,m)})};RouteElement.prototype.drawRoute=function(b,l,a,d){this._applyDefaultValues(l);if(a==undefined){a=this._cuecentGisPallet}var g=a.getImplObject();var j,p;try{if(Object.prototype.toString.call(b)=="[object String]"){j=JSON.parse(b)}else{if(Object.prototype.toString.call(b)=="[object Object]"){j=b}}}catch(m){g.logMsg("Invalid GeoJSON",2);throw"Invalid GeoJSon"}var h=j.coordinates;var q=[];for(var n=0;n<h.length;n++){var c=h[n];q.push(c[1]+" "+c[0])}var k=this;var f=h;if(l.lineDash==undefined){l.lineDash=[1,10]}if(l.useRouteFinder==false){if(l.showDirection){p=g.createPolyLine(l,k,a,k.events,k.getStyleFunction(l))}else{p=g.createPolyLine(l,k,a,k.events)}p.geoJson=j;p.draggable=false;var o=p.geoJson.coordinates;for(var n=0;n<o.length;n++){var c=o[n];g.addPointInPolyLine(p,c[1],c[0])}if(l.fitView){this.fitRouteToView(p)}k.drawnRoutes.push(p);k.currentRoute=p;if(d!=undefined){d.call(null,k)}return}this.findRoute({locations:q,type:"formatRoute",callBack:function(e){if(e.status==true){if(l.showDirection){p=g.createPolyLine(l,k,a,k.events,k.getStyleFunction(l))}else{p=g.createPolyLine(l,k,a,k.events)}p.geoJson=e.routes[0].geoJson;p.draggable=false;var s=p.geoJson.coordinates;g.logMsg("Total Points in GeoJSON : "+h.length,4);for(var t=0;t<s.length;t++){var r=s[t];g.addPointInPolyLine(p,r[1],r[0])}if(l.fitView){k.fitRouteToView(p)}k.drawnRoutes.push(p);k.currentRoute=p;if(d!=undefined){d.call(null,k)}}}},a)};RouteElement.prototype.remove=function(c,a){var b=a.getImplObject();var d=-1;for(var e=0;e<this.drawnRoutes.length;e++){if(c===this.drawnRoutes[e]){d=e;break}}if(d!=-1){b.removePolyLine(c,this);this.drawnRoutes.splice(c,1);return true}else{if(this.printLogs){console.log("Route Element not found")}return false}};RouteElement.prototype.clearAll=function(a){if(a==undefined){a=this._cuecentGisPallet}var b=a.getImplObject();var c=this;b.clearAllElements(this.drawnRoutes,function(d){},this)};RouteElement.prototype.getTargetElement=function(){return null};RouteElement.prototype._removeStartEndMarkers=function(b,a){if(b.srcMarker){a.removeMarker(b.srcMarker)}if(b.dstMarker){a.removeMarker(b.dstMarker)}};RouteElement.prototype.getStyleFunction=function(a){var b=this;return function(f,e){f=this;var j=f.getGeometry();var d=b._getMileStones(j);var h=true;if(d==0){h=false}var g=[new ol.style.Style({stroke:new ol.style.Stroke({color:a.strokeColor||"#ffcc33",width:a.strokeWidth||2,lineDash:a.lineDash})})];var c=1;j.forEachSegment(function(o,l){if(c%d==0||!h){var m=l[0]-o[0];var k=l[1]-o[1];var n=Math.atan2(k,m);g.push(new ol.style.Style({geometry:new ol.geom.Point(l),image:new ol.style.Icon({src:b._directionIcon,anchor:[0.75,0.5],rotateWithView:false,rotation:-n})}));c++;return}c++;return false});return g}};RouteElement.prototype.fitRouteToView=function(b){var a=this._cuecentGisPallet.getImplObject();a.fitGeometryInMap(b.getGeometry())};RouteElement.prototype._applyDefaultValues=function(a){if(a==undefined){a=this._defaultRouteOption;return}if(a.useRouteFinder==undefined){a.useRouteFinder=this._defaultRouteOption.useRouteFinder}if(a.strokeColor==undefined){a.strokeColor=this._defaultRouteOption.strokeColor}if(a.strokeWidth==undefined){a.strokeWidth=this._defaultRouteOption.strokeWidth}if(a.showDirection==undefined){a.showDirection=this._defaultRouteOption.showDirection}if(a.fitView==undefined){a.fitView=this._defaultRouteOption.fitView}};RouteElement.prototype._updateDirectionIcon=function(a){this._directionIcon=a};RouteElement.prototype._getMileStones=function(g){var a=Math.floor((g.getLength())/1000);var h=g.getCoordinates().length;var j=h/a;if(h<20){return 0}var c=this._cuecentGisPallet.map.getView().getResolution();var b=this._cuecentGisPallet.map;var l=this._cuecentGisPallet.map.getSize();var d=(l[0]*c)/1000;var f=(l[1]*c)/1000;var e=Math.ceil((d+f)/2);var k=e/10;j=j*k;j=Math.floor(j);return j};RouteElement.prototype.getExtent=function(d){for(var b=0;b<this.drawnRoutes.length;b++){var a=this.drawnRoutes[b];var e=a.getGeometry();var c=e.getExtent();ol.extent.extend(d,c)}};RouteElement.prototype.createLayer=function(a){this._layer=a.implObject.createFeatureContainer();a.map.addLayer(this._layer)};RouteElement.prototype.showLayer=function(){this._cuecentGisPallet.implObject.showLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.showLayer(this._clusterLayer)}};RouteElement.prototype.hideLayer=function(){this._cuecentGisPallet.implObject.hideLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.hideLayer(this._clusterLayer)}};RouteElement.prototype.setOpacity=function(a){this._cuecentGisPallet.implObject.updateOpacity(this._layer,a);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.updateOpacity(this._clusterLayer,a)}};RouteElement.prototype.getOpacity=function(){return this._cuecentGisPallet.implObject.getOpacity(this._layer)};function RoutePlayBack(a){this.routeGeoJson=undefined;this.duration=10000;this.icon=undefined;this.title=undefined;this.sliderContainer=undefined;this.palletObj=undefined;this.userCustomSlider=undefined;for(var b in a){if(a.hasOwnProperty(b)){this[b]=a[b]}}this._state=undefined;this._timerId=undefined;this._marker=undefined;this._index=1;this._points=undefined;this._timeForEachFrame=undefined;this._slider=this.slider;this._playBackMarkers=[];this.implObject=this.palletObj.getImplObject();this.poiEle=new PoiElement({});this.palletObj.addElement(this.poiEle);if(this.routeGeoJson===undefined){if(this.routeElement&&this.routeElement.currentRoute.geoJson){this.routeGeoJson=this.routeElement.currentRoute.geoJson}else{}}this.initDuration();if(this.rotateIcon==true){if(this.rotateIconConfig==undefined){this.rotateIconConfig={useCustomHeadings:false}}}if(this.sliderContainer!==undefined){this._slider=CueGis.utils.DOM.createElement({element:"input",attr:{type:"range",name:"playbackRange",min:1,max:(this.routeGeoJson.coordinates.length),value:1,step:1}},this.sliderContainer,true);this.userCustomSlider=false;this._initSlider()}else{if(this._slider!=undefined){this.userCustomSlider=true;this._initUserCustomSlider()}else{throw"No slider found"}}}RoutePlayBack.prototype._initSlider=function(){var a=this;CueGis.utils.DOM.addEvent(this._slider,"mouseup",function(){if(a._state===undefined||a._state=="STOP"){return}a._index=this.value;if(a._state==="PLAY"){a.play(a.palletObj)}});CueGis.utils.DOM.addEvent(this._slider,"mousedown",function(){if(a._state===undefined||a._state==="STOP"){return}});CueGis.utils.DOM.addEvent(this._slider,"input",function(){if(a._state===undefined||a._state==="STOP"){return}a._index=this.value;a._stepOver(this.value)})};RoutePlayBack.prototype._initUserCustomSlider=function(){var a=this;CueGis.utils.DOM.addEvent(this._slider,"mouseup",function(){if(a._state===undefined||a._state=="STOP"){return}a._index=a.sliderConfig.getSliderValue();if(a._state==="PLAY"){a.play(a.palletObj)}});CueGis.utils.DOM.addEvent(this._slider,"mousedown",function(){if(a._state===undefined||a._state==="STOP"){return}})};RoutePlayBack.prototype.updateSlidervalue=function(a){if(this._state===undefined||this._state==="STOP"){return}this._index=a;this._stepOver(a)};RoutePlayBack.prototype._action=function(b,a){return function(){if(b._points.length<b._index||b._points[b._index]===undefined){b.stop()}else{b._stepInto()}}};RoutePlayBack.prototype._rotateIcon=function(b){if(this.rotateIconConfig.useCustomHeadings===true){this.poiEle.updateIcon(this._marker,this.icon,this.routeGeoJson.headings[b])}else{var a=this._points[b+1];if(a!==undefined){var e={lat:this._points[b][1],lng:this._points[b][0],rotate:true};var c={lat:a[1],lng:a[0],rotate:true};var d=this._getAngleBetweenTwoPoints(e,c);this.poiEle.updateIcon(this._marker,this.icon,d)}}};RoutePlayBack.prototype._stepInto=function(){var c={lat:this._points[this._index][1],lng:this._points[this._index][0],rotate:true,index:this._index};this.implObject.updateMarker(this._marker,c);if(this.rotateIcon){this._rotateIcon(this._index)}if(this.doEveryFrame!==undefined){this.doEveryFrame.call(this,c)}var a=this.implObject.getMarkerPosition(this._marker);var b=this.implObject.isPointInBound(this.palletObj.map,a);if(!b){this.implObject.panTo(a.lat,a.lng)}this._updateSlider();this._index++};RoutePlayBack.prototype._stepOver=function(a){if(this._points.length<=a||this._points[a]===undefined){}else{this._index=a;this.implObject.updateMarker(this._marker,{lat:this._points[this._index][1],lng:this._points[this._index][0]});if(this.rotateIcon){this._rotateIcon(this._index)}a=this.implObject.getMarkerPosition(this._marker);var b=this.implObject.isPointInBound(this.palletObj.map,a);if(!b){this.implObject.panTo(a.lat,a.lng)}this._updateSlider();this._index++}};RoutePlayBack.prototype._updateSlider=function(){if(this._slider){if(this.userCustomSlider===true){this.sliderConfig.updateSliderFn.call(null,this._index)}else{if(this.userCustomSlider===false){this._slider.value=this._index}}}};RoutePlayBack.prototype._selfDestruct=function(){if(this._timerId!==undefined){clearInterval(this._timerId)}this._state=undefined;this._timerId=undefined;this._marker=undefined;this._index=1;this._points=undefined;this._timeForEachFrame=undefined;this.routeGeoJson=0;this.duration=10000;this.icon=undefined;this.title=undefined};RoutePlayBack.prototype.getTargetElement=function(){return null};RoutePlayBack.prototype.getExtent=function(c){for(var b=0;b<this._playBackMarkers.length;b++){var a=this._playBackMarkers[b];var e=a.getGeometry();var d=e.getExtent();ol.extent.extend(c,d)}};RoutePlayBack.prototype.initDuration=function(){this.duration=Number(this.duration);this.duration=isNaN(this.duration)?10000:this.duration};RoutePlayBack.prototype.play=function(a){if(this._state==="PLAY"){return}if(this.routeElement){this.routeGeoJson=this.routeElement.currentRoute.geoJson}var b=a.getImplObject();this.implObject=b;this._points=this.routeGeoJson.coordinates;if(this._state==="PAUSE"){this._timerId=setInterval(this._action(this,b),this._timeForEachFrame);this._state="PLAY";if(this.playBackHandler&&this.playBackHandler.play){this.playBackHandler.play.call(null)}return}if(this._marker===undefined){this._marker=b.createMarker(this.poiEle,a,{icon:this.icon,title:this.title,draggable:false},this._points[0][1],this._points[0][0],this.markerEvents);this.poiEle.poiList.push(this._marker);this._marker.routePlayBackObj=this;this._playBackMarkers.push(this._marker);if(this.animation){b.focus(this._marker,{},{animation:true,animationClass:this.animationClass})}if(this.rotateIcon){this._rotateIcon(0)}}else{b.updateMarker(this._marker,{lat:this._points[0][1],lng:this._points[0][0]});if(this.rotateIcon){this._rotateIcon(0)}}if(this._points.length>0){this._timeForEachFrame=this.duration/this._points.length;console.log(this._timeForEachFrame);this._timerId=setInterval(this._action(this,b),this._timeForEachFrame);this._state="PLAY"}if(this.playBackHandler&&this.playBackHandler.play){this.playBackHandler.play.call(null)}};RoutePlayBack.prototype.pause=function(){this._state="PAUSE";clearInterval(this._timerId);if(this.playBackHandler&&this.playBackHandler.pause){this.playBackHandler.pause.call(null)}};RoutePlayBack.prototype.resume=function(a){this.play(a);if(this.playBackHandler&&this.playBackHandler.resume){this.playBackHandler.resume.call(null)}};RoutePlayBack.prototype.stop=function(){if(this._state==="STOP"){return}this._state="STOP";if(this.playBackHandler&&this.playBackHandler.stop){this.playBackHandler.stop.call(null)}this._index=1;clearInterval(this._timerId)};RoutePlayBack.prototype.clear=function(){var a=this._playBackMarkers.indexOf(this._marker);if(a!=-1){this._playBackMarkers.splice(a,1);this.poiEle.removePOI(this._marker);this._selfDestruct()}};RoutePlayBack.prototype.getState=function(){if(this._state===undefined){return"STOP"}return this._state};RoutePlayBack.prototype.clearAll=function(){this.poiEle.clearAll(this.palletObj);return};RoutePlayBack.prototype.updateRouteElement=function(a){if(a){this.routeGeoJson=a.currentRoute.geoJson}};RoutePlayBack.prototype.updateDuration=function(a){this.duration=a;this.initDuration()};RoutePlayBack.prototype.hideAll=function(){this.poiEle.hideAll();return};RoutePlayBack.prototype.showAll=function(){this.poiEle.showAll();return};RoutePlayBack.prototype.jumpToIndex=function(a){this._stepOver(a)};RoutePlayBack.prototype._getAngleBetweenTwoPoints=function(f,c){return angleDeg=Math.atan2(c.lng-f.lng,c.lat-f.lat)*180/Math.PI;var b=3.14;var e=c.lng-f.lng;var a=c.lat-f.lat;var d=(b*0.5)-atan(a/e);if(e>0){return d}else{if(e<0){return d+b}else{if(a<0){return b}}}};function DistanceElement(b){this.container=null;this.distanceOptions=null;this.distMarkerOptions=null;this.currentDistance=null;this.list=[];this.metricConfig=null;this.queryOption=undefined;this._layer=undefined;if(b==null){console.log("distanceElementOptions cannot be null");return null}for(var a in b){this[a]=b[a]}this.printLogs=(this.printLogs==null)?false:true;if(this.metricConfig==undefined){this.metricConfig={type:"geodisc",unit:1}}if(this.container==null&&b==null){console.log("container/distanceElementOptions cannot be null");return null}}DistanceElement.prototype.getTargetElement=function(){return this.container};DistanceElement.prototype.mapEventHandler=function(b,a){};DistanceElement.prototype.eventHandler=function(b,c){var a=c._cuecentGisPallet.getImplObject();a.enableDrawing(this,a,this._cuecentGisPallet);a.isDrawMode=true};DistanceElement.prototype.mapCompletedEvent=function(b,a){this.currentDistance=null};DistanceElement.prototype.getDistance=function(c,a,d){if(d==undefined){d=this.metricConfig}var b=a.getImplObject();return b.getLineLength(c,d)};DistanceElement.prototype.remove=function(b){var a=this._cuecentGisPallet.getImplObject();a.removeDistanceElement(b,this)};DistanceElement.prototype.clearAll=function(c){var a=c.getImplObject();if(this.list){for(var b=0;b<this.list.length;b++){this.remove(this.list[b])}}};DistanceElement.prototype.updateMetricConfig=function(a){this.metricConfig=a};DistanceElement.prototype.updateQueryOptions=function(a){this.queryOption=a};DistanceElement.prototype.getExtent=function(a){for(var b=0;b<this.list.length;b++){var d=this.list[b];var e=d.getGeometry();var c=e.getExtent();ol.extent.extend(a,c)}};DistanceElement.prototype.createLayer=function(a){this._layer=a.implObject.createFeatureContainer();a.map.addLayer(this._layer)};DistanceElement.prototype.showLayer=function(){this._cuecentGisPallet.implObject.showLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.showLayer(this._clusterLayer)}var c=this.list;for(var a=0;a<c.length;a++){var b=c[a];b.measureToolTip.toolTipDiv.style.display="block";if(b.toolTips!=undefined){for(var d=0;d<b.toolTips.length;d++){b.toolTips[d].toolTipDiv.style.display="block"}}}};DistanceElement.prototype.hideLayer=function(){this._cuecentGisPallet.implObject.hideLayer(this._layer);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.hideLayer(this._clusterLayer)}var c=this.list;for(var a=0;a<c.length;a++){var b=c[a];b.measureToolTip.toolTipDiv.style.display="none";if(b.toolTips!=undefined){for(var d=0;d<b.toolTips.length;d++){b.toolTips[d].toolTipDiv.style.display="none"}}}};DistanceElement.prototype.setOpacity=function(b){this._cuecentGisPallet.implObject.updateOpacity(this._layer,b);if(this.isClusteringEnabled){this._cuecentGisPallet.implObject.updateOpacity(this._clusterLayer,b)}var d=this.list;for(var a=0;a<d.length;a++){var c=d[a];c.measureToolTip.toolTipDiv.style.opacity=b;if(c.toolTips!=undefined){for(var e=0;e<c.toolTips.length;e++){c.toolTips[e].toolTipDiv.style.opacity=b}}}};DistanceElement.prototype.getOpacity=function(){return this._cuecentGisPallet.implObject.getOpacity(this._layer)};function MeasureTool(a,c){this.container=null;this.lineList=[];this.polygonList=[];this.circleList=[];this._defLineConfig={style:"-",strokeColor:"#CC0033",strokeWidth:"",metricUnit:1};this._defPolygonConfig={style:"-",strokeColor:"",strokeWidth:"",fillColor:"",fillOpacity:"",metricUnit:1};this._defCircleConfig={style:"-",strokeColor:"",strokeWidth:"",fillColor:"",fillOpacity:"",metricUnit:1};this._defMetricConfig={type:"geodisc",unit:1};for(var b in a){this[b]=a[b]}this.printLogs=(this.printLogs==null)?false:true;if(this.toolType==undefined){this.toolType="line"}var d=this;this._distanceElement=new DistanceElement({container:undefined,distanceOptions:{strokeColor:a.lineConfig.strokeColor||this._defLineConfig.strokeColor,strokeOpacity:0.6,draggable:false,editable:false},distMarkerOptions:{draggable:false,clickable:true},metricConfig:{unit:a.lineConfig.unit,type:"geodisc"},toolTipCls:a.lineConfig.toolTipCls,labelCls:a.lineConfig.labelCls,events:undefined,queryOption:{callBack:function(h,e,f,g){var j=h.getDistance(g,e,{unit:d.getUnit(),type:"geodisc"});d.callBack.call(null,{unit:d.getUnit(),type:d.toolType,measurement:j})}}});c.addElement(this._distanceElement,true);this._polygonElement=new FencingElement({container:undefined,fenceOptions:{strokeColor:a.polygonConfig.strokeColor||this._defPolygonConfig.strokeColor,strokeOpacity:a.polygonConfig.strokeOpacity||this._defPolygonConfig.strokeOpacity,fillColor:a.polygonConfig.fillColor||this._defPolygonConfig.fillColor,fillOpacity:a.polygonConfig.fillOpacity||this._defPolygonConfig.fillOpacity,draggable:false,editable:false},toolTipCls:a.polygonConfig.toolTipCls,labelCls:a.polygonConfig.labelCls,metricConfig:{unit:a.polygonConfig.unit||1,type:a.polygonConfig.type||"geodisc"},events:undefined,isClusteringEnabled:false,queryOption:{callBack:function(h,e,f,g){d.callBack.call(null,{unit:d.getUnit(),type:d.toolType,measurement:h.getArea({unit:d.getUnit(),calcType:2})})}}});c.addElement(this._polygonElement,true);this._circleElement=new FencingElement({container:undefined,fenceOptions:{strokeColor:a.circleConfig.strokeColor||this._defCircleConfig.strokeColor,strokeOpacity:a.circleConfig.strokeOpacity||this._defCircleConfig.strokeOpacity,fillColor:a.circleConfig.fillColor||this._defCircleConfig.fillColor,fillOpacity:a.circleConfig.fillOpacity||this._defCircleConfig.fillOpacity,draggable:false,editable:false},metricConfig:{unit:a.circleConfig.unit||1,type:a.circleConfig.type||"geodisc"},toolTipCls:a.circleConfig.toolTipCls,labelCls:a.circleConfig.labelCls,events:undefined,fenceType:"CIRCLE",isClusteringEnabled:false,queryOption:{callBack:function(j,f,g,h){var e=j.getRadius(h,f);e=g.meterToXConverter(d.getUnit(),e);d.callBack.call(null,{unit:d.getUnit(),type:d.toolType,measurement:e})}}});c.addElement(this._circleElement,true);this.currentTool=this._distanceElement}MeasureTool.prototype.getTargetElement=function(){return this.container};MeasureTool.prototype.mapEventHandler=function(b,a){};MeasureTool.prototype.eventHandler=function(a,b){};MeasureTool.prototype.mapCompletedEvent=function(b,a){this.currentTool=null};MeasureTool.prototype.clearAll=function(a){this.clearLines();this.clearPolygons();this.clearCircles()};MeasureTool.prototype.updateMetricConfig=function(a){this._defMetricConfig=a;this._polygonElement.updateMetricConfig(a);this._distanceElement.updateMetricConfig(a);this._circleElement.updateMetricConfig(a)};MeasureTool.prototype.updateTool=function(b){this.toolType=b;var a=this._cuecentGisPallet;if(this.toolType=="polygon"){this._polygonElement._cuecentGisPallet=a;a.updateCurrentElement(this._polygonElement);this.currentTool=this._polygonElement}else{if(this.toolType=="circle"){this._circleElement._cuecentGisPallet=a;a.updateCurrentElement(this._circleElement);this.currentTool=this._circleElement}else{this._distanceElement._cuecentGisPallet=a;a.updateCurrentElement(this._distanceElement);this.currentTool=this._distanceElement}}};MeasureTool.prototype.clearLines=function(){this._distanceElement.clearAll(this._cuecentGisPallet)};MeasureTool.prototype.clearPolygons=function(){this._polygonElement.clearAll(this._cuecentGisPallet)};MeasureTool.prototype.clearCircles=function(){this._circleElement.clearAll(this._cuecentGisPallet)};MeasureTool.prototype.getUnit=function(){return this._defMetricConfig.unit};MeasureTool.prototype.getExtent=function(a){this._distanceElement.getExtent(a);this._polygonElement.getExtent(a);this._circleElement.getExtent(a)};MeasureTool.prototype.showLayer=function(a){if(a=="line"){this._distanceElement.showLayer()}else{if(a=="polygon"){this._polygonElement.showLayer()}else{if(a=="circle"){this._circleElement.showLayer()}else{this._distanceElement.showLayer();this._polygonElement.showLayer();this._circleElement.showLayer()}}}};MeasureTool.prototype.hideLayer=function(a){if(a=="line"){this._distanceElement.hideLayer()}else{if(a=="polygon"){this._polygonElement.hideLayer()}else{if(a=="circle"){this._circleElement.hideLayer()}else{this._distanceElement.hideLayer();this._polygonElement.hideLayer();this._circleElement.hideLayer()}}}};MeasureTool.prototype.setOpacity=function(b,a){if(b=="line"){this._distanceElement.setOpacity(a)}else{if(b=="polygon"){this._polygonElement.setOpacity(a)}else{if(b=="circle"){this._circleElement.setOpacity(a)}else{this._distanceElement.setOpacity(a);this._polygonElement.setOpacity(a);this._circleElement.setOpacity(a)}}}};MeasureTool.prototype.getOpacity=function(a){if(a=="line"){return this._cuecentGisPallet.implObject.getOpacity(this._distanceElement._layer)}else{if(a=="polygon"){return this._cuecentGisPallet.implObject.getOpacity(this._polygonElement._layer)}else{if(a=="circle"){return this._cuecentGisPallet.implObject.getOpacity(this._circleElement._layer)}else{return this._cuecentGisPallet.implObject.getOpacity(this._distanceElement._layer)}}}};function DrawTool(a){this.container=null;this._layer=undefined;this.textLabels=[];this._defLineConfig={style:"-",strokeColor:"BLACK",draggable:false};this._defPolygonConfig={strokeColor:"BLACK",draggable:false,fillOpacity:0};this._defCircleConfig={style:"-",strokeColor:"BLACK",draggable:false,fillOpacity:0};this._defRectConfig={style:"-",strokeColor:"BLACK",draggable:false,fillOpacity:0};this._defPointConfig={style:"-",strokeColor:"BLACK",fillColor:"BLACK",draggable:false};for(var b in a){this[b]=a[b]}this.printLogs=(this.printLogs==null)?false:true;if(this.toolType==undefined){this.toolType="line"}this_=this}DrawTool.prototype.getTargetElement=function(){return this.container};DrawTool.prototype.mapEventHandler=function(b,a){};DrawTool.prototype.eventHandler=function(a,b){};DrawTool.prototype.mapCompletedEvent=function(b,a){this.currentTool=null};DrawTool.prototype.clearAll=function(){var a=this._cuecentGisPallet.getImplObject();a.clearDrawElement(this);for(var b=0;b<this.textLabels.length;b++){a.removeText(this.textLabels[b])}};DrawTool.prototype.updateTool=function(c){this.toolType=c;var d={};var e=this;var b=this._cuecentGisPallet;var a=this._cuecentGisPallet.getImplObject();if(this.toolType=="POLYGON"){d.fenceOptions=this._defPolygonConfig;d.fenceType="POLYGON";a.DrawTools(d,a,b,this)}else{if(this.toolType=="CIRCLE"){d.fenceOptions=this._defCircleConfig;d.fenceType="CIRCLE";a.DrawTools(d,a,b,this)}else{if(this.toolType=="RECTANGLE"){d.fenceOptions=this._defRectConfig;d.fenceType="RECTANGLE";a.DrawTools(d,a,b,this)}else{if(this.toolType=="LINE"){d.fenceOptions=this._defLineConfig;d.fenceType="LINE";a.DrawTools(d,a,b,this)}else{if(this.toolType=="POINT"){d.fenceOptions=this._defPointConfig;d.fenceType="POINT";a.DrawTools(d,a,b,this)}else{if(this.toolType=="TEXT"){d.fenceType="TEXT";a.stopDrawing();a.isDrawMode=true;a._currentDraw={type:"DrawText",drawTool:this};if(b.drawTextHandler==undefined){b.drawTextHandler=this.drawTextHandler||function(f){if(e._txtInputWnd!=undefined){e._txtInputWnd.style.display="block";e._txtInputWnd.style.left=(f[0]-3)+"px";e._txtInputWnd.style.top=(f[1]-17)+"px";e._txtInput.focus();return}e._txtInputWnd=document.createElement("DIV");e._txtInputWnd.setAttribute("id","drwTxtWnd");e._txtInputWnd.setAttribute("class","drawToolWindow");e._txtInputWnd.style.left=(f[0]-3)+"px";e._txtInputWnd.style.top=(f[1]-17)+"px";e._txtInput=document.createElement("input");e._txtInput.setAttribute("id","drwTxt");e._txtInput.setAttribute("class","drawToolTxtBox");e._txtInput.setAttribute("type","text");e._txtInput.setAttribute("autofocus","autofocus");e._txtInput.addEventListener("blur",function(g){e._setDrawText(e._txtInput.value)});e._txtInput.addEventListener("keypress",function(g){if(g.keyCode==13){e._setDrawText(e._txtInput.value)}});e._txtInputWnd.appendChild(e._txtInput);document.body.appendChild(e._txtInputWnd)}}b.isDrawTextMode=true}}}}}}};DrawTool.prototype.createLayer=function(a){this._layer=a.implObject.createFeatureContainer();a.map.addLayer(this._layer)};DrawTool.prototype.showLayer=function(){this._cuecentGisPallet.implObject.showLayer(this._layer);for(var b=0;b<this.textLabels.length;b++){var a=this.textLabels[b];a.toolTipDiv.style.display="block"}};DrawTool.prototype.hideLayer=function(){this._cuecentGisPallet.implObject.hideLayer(this._layer);for(var b=0;b<this.textLabels.length;b++){var a=this.textLabels[b];a.toolTipDiv.style.display="none"}};DrawTool.prototype.setOpacity=function(a){this._cuecentGisPallet.implObject.updateOpacity(this._layer,a);for(var c=0;c<this.textLabels.length;c++){var b=this.textLabels[c];b.toolTipDiv.style.opacity=a}};DrawTool.prototype.getOpacity=function(){return this._cuecentGisPallet.implObject.getOpacity(this._layer)};DrawTool.prototype.setText=function(b){var a=this._cuecentGisPallet.implObject.saveText(b,this._cuecentGisPallet._drawTextPosition);this._cuecentGisPallet.implObject.adjustText(a);this.textLabels.push(a);if(this.callBack){this.callBack.call(this)}};DrawTool.prototype._setDrawText=function(a){this._txtInputWnd.style.display="none";this._txtInput.value="";this.setText(a)};DrawTool.prototype.removeTextWnd=function(){if(this._cuecentGisPallet.drawTextHandler==undefined){this._txtInputWnd.style.display="none";this._txtInput.value=""}this._cuecentGisPallet.isDrawTextMode=false};if(!CueGis){var CueGis={}}CueGis.uiConfig={title:"CueGis Menus",items:[{name:"Tools",icon:"",id:"CueGis_Pallete_Tools",description:"",toolTip:"Clear Selection",leaf:false,childrens:[{name:"Toogle Hand",icon:"CueGis/icons/clear.png",id:"CueGis_Pallete_Tools_Clear",description:"",toolTip:"Clear selection",leaf:true,callBack:"CueGis.Pallete.impl.clearSelection"},{name:"Clear All",icon:"CueGis/icons/clearAll.png",id:"CueGis_Pallete_Tools_ClearAll",description:"",toolTip:"Clear All elements in Map",leaf:true,callBack:"CueGis.Pallete.impl.clearAll"},{name:"Zoom",icon:"CueGis/icons/zoom.png",id:"CueGis_Pallete_Zoom_Select",description:"",toolTip:"Select a rectangular area and zoom",leaf:true,callBack:"CueGis.Pallete.impl.zoom"}]},{name:"Map",icon:"",id:"CueGis_Pallete_MapType",description:"",toolTip:"Change MapType",leaf:false,childrens:[{name:"Road",icon:"CueGis/icons/road.png",id:"CueGis_Pallete_MapType_ROADMAP",description:"",toolTip:"Switch to RoadMap",leaf:true,callBack:"CueGis.Pallete.impl.changeMapType"},{name:"Satellite",icon:"CueGis/icons/satellite.png",id:"CueGis_Pallete_MapType_SATELLITE",description:"",toolTip:"Switch to Satellite Map",leaf:true,callBack:"CueGis.Pallete.impl.changeMapType"},{name:"Terrain",icon:"CueGis/icons/terrain.png",id:"CueGis_Pallete_MapType_TERRAIN",description:"",toolTip:"Switch to Terrain Map",leaf:true,callBack:"CueGis.Pallete.impl.changeMapType"},{name:"Hybrid",icon:"CueGis/icons/hybrid.png",id:"CueGis_Pallete_MapType_HYBRID",description:"",toolTip:"Switch to Hybrid Map",leaf:true,callBack:"CueGis.Pallete.impl.changeMapType"}]},{name:"GEO",icon:"",id:"CueGis_Pallete_Geo",description:"",toolTip:"Geo",leaf:false,childrens:[{name:"LatLng",icon:"CueGis/icons/geoLatLng.png",id:"CueGis_Pallete_Geo_getLatLng",description:"",toolTip:"Add a POI in the location",leaf:true,callBack:"getLatLng"},{name:"Address",icon:"CueGis/icons/geoAddrs.png",id:"CueGis_Pallete_Geo_Address",description:"",toolTip:"Add a POI in the location",leaf:true,callBack:"getAddress"}]},{name:"Fence",icon:"",id:"CueGis_Pallete_Fence",description:"",toolTip:"Create Fence",fenceEvents:{rightclick:"saveFence",click:function(){},dblclick:function(){},mouseover:function(){},mouseout:function(){}},childrens:[{name:"Polygon",icon:"CueGis/icons/polygon.png",id:"CueGis_Pallete_Fence_Polygon",description:"",toolTip:"Create Polygon Fence",leaf:true,callBack:"CueGis.Pallete.impl.addFence"},{name:"Circle",icon:"CueGis/icons/circle.png",id:"CueGis_Pallete_Fence_Circle",description:"",toolTip:"Create Circle Fence",leaf:true,callBack:"CueGis.Pallete.impl.addFence"},{name:"Rectangle",icon:"CueGis/icons/rectangle.png",id:"CueGis_Pallete_Fence_Rectangle",description:"",toolTip:"Create Fence",leaf:true,callBack:"CueGis.Pallete.impl.addFence"}]},{name:"POI",icon:"",id:"CueGis_Pallete_POI",description:"",toolTip:"Create POI",leaf:false,poiEvents:{rightclick:"savePOI",click:function(){},dblclick:function(){},mouseover:function(b,a,c,d){console.log("MOUSE OVER");console.log(arguments)},mouseout:function(b,a,c,d){console.log("MOUSE OUT");console.log(arguments)},drag:function(){}},clusterEvents:{click:function(a,b){var d=[];for(var c=0;c<b.length;c++){var e=b[c];d.push(e._toolTip)}Ext.Msg.alert("Click",d.join(","))},rightclick:function(a,b){var d=[];for(var c=0;c<b.length;c++){var e=b[c];d.push(e._toolTip)}Ext.Msg.alert("Right Click",d.join(","))},dblclick:function(a,b){var d=[];for(var c=0;c<b.length;c++){var e=b[c];d.push(e._toolTip)}Ext.Msg.alert("Dbl Click",d.join(","))},mouseover:function(a,b,c){ClusterViewer.show({evt:a,members:b,parent:c})},mouseout:function(a,b,c){}},childrens:[{name:"Restaurant",icon:"CueGis/icons/res.png",highlightIcon:"CueGis/icons/res_Select.png",id:"CueGis_Pallete_POI_Restaurant",description:"",toolTip:"Create a Restaurant POI",leaf:true,callBack:"CueGis.Pallete.impl.addPOI"},{name:"Petrol Bank",icon:"CueGis/icons/petrolBank.png",highlightIcon:"CueGis/icons/petrolBank_Select.png",id:"CueGis_Pallete_POI_PetrolBank",description:"",toolTip:"Create a Petrol bank POI",leaf:true,callBack:"CueGis.Pallete.impl.addPOI"}]},{name:"Load",icon:"",id:"CueGis_Pallete_Load",description:"",toolTip:"Load Elements",leaf:false,childrens:[{name:"Fence",icon:"CueGis/icons/fence.png",id:"CueGis_Pallete_Load_FENCE",description:"",toolTip:"Load Fence",leaf:true,callBack:"loadFence"},{name:"POI",icon:"CueGis/icons/poi.png",id:"CueGis_Pallete_Load_POI",description:"",toolTip:"Load POI",leaf:true,callBack:"loadPOI"},{name:"Tracking Element",icon:"CueGis/icons/trackingElement.png",id:"CueGis_Pallete_Load_TrackingElement",description:"",toolTip:"Load Tracking Element",leaf:true,callBack:"loadTrackingElement"},{name:"Tracking Element With Route",icon:"CueGis/icons/trackingElementWithRoute.png",id:"CueGis_Pallete_Load_TrackingElementWithRoute",description:"",toolTip:"Load Tracking Element with route",leaf:true,callBack:"loadTrackingElementWithRoute"}]},{name:"Search",icon:"",id:"CueGis_Pallete_Search",description:"",toolTip:"Find Events",leaf:false,childrens:[{name:"Search Vehicles",icon:"CueGis/icons/find.png",id:"CueGis_Pallete_Search_TrackingElements",description:"",toolTip:"Find Tracking Elements in the area",leaf:true,callBack:"CueGis.Pallete.impl.find",findEvents:{click:"getTrackingElementId"},trackingElementEvents:{click:"showEventProperties"}},{name:"Distance",icon:"CueGis/icons/DistanceElement.png",id:"CueGis_Pallete_Others_distanceElement",description:"To get the distance of the selected points",toolTip:"Find Distance",leaf:true,events:{rightclick:"getDistance",mouseover:function(){},mouseout:function(){}},callBack:"showMeasureToolMenu"},{name:"FreeHandRectangle",icon:"CueGis/icons/FreeHandRectangle.png",id:"CueGis_Pallete_Search_FreeHandRectangle",description:"To draw the rectangle without predefined points",toolTip:" Draw FreeHandRectangle",leaf:true,events:{rightclick:function(){arguments[2].removeFence(arguments[1])},click:function(){console.log("CLICK")},dblclick:function(){console.log("DBL CLICK")},mouseover:function(){console.log("MOUSE OVER")},mouseout:function(){console.log("MOUSE OUT")}}}]},{name:"Buffer",icon:"",id:"CueGis_Pallete_Buffer",description:"",toolTip:"Create Buffer",leaf:false,childrens:[{name:"LineBuffer",icon:"CueGis/icons/lineBuffer.png",id:"CueGis_Pallete_Buffer_LineBuffer",description:"",toolTip:"Line Buffer",leaf:true,callBack:"CueGis.Pallete.impl.addLineBuffer"}]},{name:"Others",icon:"",id:"CueGis_Pallete_Others",description:"",toolTip:"Others",leaf:false,childrens:[{name:"Settings",icon:"CueGis/icons/settings.png",id:"CueGis_Pallete_Others_Settings",description:"",toolTip:"Settings",leaf:true,callBack:"showSettings"},{name:"Route",icon:"CueGis/icons/routeElement.png",id:"CueGis_Pallete_Others_routeElement",description:"",toolTip:"Find/Draw Route",leaf:true,callBack:"showRouteMenu"},{namer:"Fit",icon:"CueGis/icons/fit.png",id:"CueGis_Pallete_Others_Fit",description:"",toolTip:"Fit View",leaf:true,callBack:"fitView"},{name:"Drawing",icon:"CueGis/icons/draw.png",id:"CueGis_Others_Draw_Tools",description:"",toolTip:"Drawing Tool",leaf:true,callBack:"showDraw"},{name:"Weather",icon:"CueGis/icons/weather.png",id:"CueGis_Others_Draw_Weather",description:"",toolTip:"Toogle Weather",leaf:true,callBack:"showWeather"}]}]};GisTester={showWeather:false};CueGis.Pallete={cuecentGISPallet:undefined,getCuecentGISPallet:function(){return this.cuecentGISPallet},fencingElement:undefined,getFencingElement:function(){return this.fencingElement},searchFenceElement:undefined,getSearchFenceElement:function(){return this.searchFenceElement},poiElement:undefined,getPoiElement:function(){return this.poiElement},trackingElement:undefined,getTrackingElement:function(){return this.trackingElement},lineBufferElement:undefined,getLineBufferElement:function(){return this.lineBufferElement},routeElement:undefined,getRouteElement:function(){return this.routeElement},zoomContainer:undefined,freeHandRectangleElement:undefined,getFreeHandRectangleElement:function(){return this.freeHandRectangleElement},init:function(j){CueGis.Pallete.cuecentGISPallet=j;var f=CueGis.uiConfig.items;var l=CueGis.utils.DOM;var a=l.createElement({element:"DIV",attr:{id:"verticalToolBar"}},j._parentContainer,true);for(index in f){var m=f[index];if(typeof m=="function"){continue}var g=l.createElement({element:"DIV",attr:{"class":"menu",id:m.id,title:m.toolTip}},a);var c=l.createElement({element:"DIV",attr:{"class":"menuTitle",id:m.id+"_name"},text:m.name},g);if(m.id=="CueGis_Pallete_Fence"){CueGis.Pallete.fencingElement=new FencingElement({container:undefined,fenceOptions:{strokeColor:"#FF4000",strokeOpacity:0.6,fillColor:"#FF4000",fillOpacity:0.2,draggable:true,editable:true},events:m.fenceEvents,isClusteringEnabled:true});j.addElement(CueGis.Pallete.fencingElement)}else{if(m.id=="CueGis_Pallete_POI"){CueGis.Pallete.poiElement=new PoiElement({container:g,markerOptions:{draggable:true},events:m.poiEvents,isClusteringEnabled:true,clusterEvents:m.clusterEvents});j.addElement(CueGis.Pallete.poiElement);j.addDragHandler(function(){if(ClusterViewer._overLay){ClusterViewer.hide()}});j.addZoomHandler(function(){if(ClusterViewer._overLay){ClusterViewer.hide()}});ClusterViewer.setItemHandler(function(o,n,p){var q=new Ext.menu.Menu({items:[{text:"Name",handler:function(){Ext.Msg.alert("Name",p._toolTip)}},{text:"Pan",handler:function(){CueGis.Pallete.poiElement.pan(p)}},{text:"Pan & Zoom",handler:function(){CueGis.Pallete.poiElement.pan(p,true)}},{text:"Focus",handler:function(){CueGis.Pallete.poiElement.pan(p,true);CueGis.Pallete.poiElement.highlight(p,{animation:true})}}]});q.showAt(o)})}}for(childIndex in m.childrens){var b=m.childrens[childIndex];if(typeof b=="function"){continue}var e=l.createElement({element:"DIV",attr:{"class":"menuItem",data:JSON.stringify(b),id:b.id,title:b.toolTip}},g);var h=l.createElement({element:"IMG",attr:{src:b.icon}},e);if(b.id=="CueGis_Pallete_Search_TrackingElements"){CueGis.Pallete.searchFenceElement=new FencingElement({container:e,fenceOptions:{strokeColor:"#FFBF00",strokeOpacity:0.6,fillColor:"#FFBF00",fillOpacity:0.2,draggable:true,editable:true},fenceType:"CIRCLE",fenceRadius:1000,events:b.findEvents});j.addElement(CueGis.Pallete.searchFenceElement);CueGis.Pallete.trackingElement=new TrackingElement({markerOptions:{draggable:true,icon:"CueGis/icons/vehicle.png"},isClusteringEnabled:true,clusterConfig:{fillColor:"#FFCC00",strokeColor:"#336688"},events:b.trackingElementEvents,clusterEvents:{mouseover:function(n,o){showClusterMessage(n,o)},mouseout:function(n,o){hideClusterMessage(n,o)}}},j);j.addElement(CueGis.Pallete.trackingElement)}if(b.id=="CueGis_Pallete_Others_distanceElement"){CueGis.Pallete.MeasureTool=new MeasureTool({container:e,lineConfig:{strokeColor:"#086A87",fillColor:"#086A87",draggable:false,editable:false},polygonConfig:{strokeColor:"#FE9A2E",strokeOpacity:0.6,fillColor:"#FE9A2E",fillOpacity:0.6},circleConfig:{strokeColor:"#04B431",strokeOpacity:0.6,fillColor:"#CEECF5",fillOpacity:0.6,labelCls:"measureLabel"},toolType:"polygon",events:b.events,callBack:function(n){Ext.getCmp("showMeasureToolMenu-distance").setValue(n.measurement)}},j);j.addElement(CueGis.Pallete.MeasureTool)}if(b.id=="CueGis_Pallete_Search_FreeHandRectangle"){CueGis.Pallete.freeHandRectangleElement=new FencingElement({container:e,fenceOptions:{strokeColor:"#FFBF00",strokeOpacity:0.6,fillColor:"#FFBF00",fillOpacity:0.2,draggable:true,editable:true},fenceType:"RECTANGLE",events:b.events,queryOption:{callBack:function(r,o,p,q){var n=r.exportGeoJsonObject(q,o);console.log(JSON.stringify(n))}}});j.addElement(CueGis.Pallete.freeHandRectangleElement)}if(b.id=="CueGis_Others_Draw_Tools"){CueGis.Pallete.DrawTool=new DrawTool({toolType:"polygon",callBack:function(){CueGis.Pallete.DrawTool.updateTool(GisTester.drawTool);j.updateCurrentElement(CueGis.Pallete.DrawTool)},drawTextHandler_setToEnableCustomUI:function(n){Ext.QuickTips.init();var o=new Ext.Window({title:"Add Text",height:150,width:400,items:[{xtype:"htmleditor",id:"drawTool-TextArea"}],buttons:[{text:"Save",handler:function(){var p=Ext.getCmp("drawTool-TextArea").getRawValue();CueGis.Pallete.DrawTool.setText(p);o.close()}}]});o.setPagePosition(n[0],n[1]);o.show()}});j.addElement(CueGis.Pallete.DrawTool)}if(b.id=="CueGis_Pallete_Buffer_LineBuffer"){CueGis.Pallete.lineBufferElement=new LineBufferElement({container:e,lineOptions:{strokeColor:"RED",strokeOpacity:0.6,strokeWeight:3},bufferOptions:{strokeColor:"GREEN",strokeOpacity:0.6,fillColor:"#FFBF00",fillOpacity:0.2},bufferWidth:100,events:{rightclick:"showLineBufferMenu"}},j);j.addElement(CueGis.Pallete.lineBufferElement)}}}var k=document.querySelector("#verticalToolBar");var d=new Draggabilly(k,{containment:j.container});CueGis.utils.DOM.addEvent(a,"click",function(q){try{var r=undefined;if(q.srcElement){r=q.srcElement.parentNode.attributes.getNamedItem("data");r=r?r.value:undefined}else{if(q.target){if(q.target.parentNode.attributes.data){r=q.target.parentNode.attributes.data.value}}}if(r){r=JSON.parse(r);if(typeof r.callBack=="string"){if(window[r.callBack]&&typeof window[r.callBack]=="function"){window[r.callBack].call(q,r)}else{if(r.callBack.indexOf(".")!=-1){var n=r.callBack.split(".");var p=window;for(index in n){var o=n[index];if(p[o]){p=p[o]}}p.call(q,r)}}}}}catch(s){console.error(s)}});CueGis.Pallete.zoomContainer=document.getElementById("CueGis_Pallete_Zoom_Select");if(CueGis.Pallete.zoomContainer){CueGis.Pallete.cuecentGISPallet.zoomContainer=CueGis.Pallete.zoomContainer;CueGis.Pallete.cuecentGISPallet.enableDragZoom()}if(document.getElementById("CueGis_Pallete_Fence")){fencingElement=new FencingElement({})}this.routeElement=new RouteElement({events:{rightclick:function(p,q,s,r,o,n,t){s.remove(q,r)}}});j.addElement(this.routeElement)},impl:{changeMapType:function(a){if(CueGis.Pallete.cuecentGISPallet){var b=a.id.split("_")[3];if(b){CueGis.Pallete.cuecentGISPallet.setMapType(b)}}},addPOI:function(a){if(a.id.indexOf("_")!=-1){var b=a.id.split("_");if(b[2]&&b[2].toUpperCase()==="POI"){CueGis.Pallete.poiElement.updateMarkerOption({icon:a.icon,highlightIcon:a.highlightIcon,draggable:true})}}},addFence:function(a){if(a.id.indexOf("_")!=-1){var b=a.id.split("_");if(b[2]&&b[2].toUpperCase()==="FENCE"){if(b[3]){CueGis.Pallete.fencingElement.updateFenceType(b[3].toUpperCase());CueGis.Pallete.cuecentGISPallet.updateCurrentElement(CueGis.Pallete.fencingElement)}}}},zoom:function(){},clearSelection:function(){CueGis.Pallete.cuecentGISPallet.stopElementSelection()},clearAll:function(){CueGis.Pallete.cuecentGISPallet.clearElementsInMap();if(ClusterViewer){ClusterViewer.hide()}},find:function(){},addLineBuffer:function(){}},util:{clearAllElements:function(b){for(index in b){var a=b[index];if(Object.prototype.toString(a)!=="[object Function]"){if(a.setMap){a.setMap(null)}}}}}};function fitView(){CueGis.Pallete.cuecentGISPallet.fitView()}function showWeather(){if(GisTester.showWeather==false){CueGis.Pallete.cuecentGISPallet.showWeather();GisTester.showWeather=true}else{CueGis.Pallete.cuecentGISPallet.hideWeather();GisTester.showWeather=false}}FencingElement.prototype.loadFenceFromGiSEngine=function(d,a){if(d===undefined||d===null){throw"config parameter not found"}if(a==undefined||a===null){throw"palletObject parameter not found"}var e="fenceName="+d.fenceName;e=e+"&tenantID="+CueGis.tenantID;var c=a.getImplObject();var b=this;new AjaxRequest().getRequest(CueGis.gisEngineUrl+CueGis.GisApi.Fence.get,e,function(){if(this.readyState==4){try{var f=JSON.parse(this.responseText);var g=JSON.parse(f.geoJson);b.load({geoJson:g,type:f.fenceType,config:d,cuecentGISPallet:a})}catch(h){console.error(h)}}},"text/plain")};FencingElement.prototype.saveFenceInGisEngine=function(d,c){var a=this.exportGeoJsonObject(d.fence,d.palletObject);var b=d.fenceName;var e={};e.name=b;e.fenceType=d.fence.fenceType;e.fenceCategory={category:d.category};e.forceFenceCategoryCreation=true;e.geoJson=a;e.tenantID=CueGis.tenantID;new AjaxRequest().postRequest(CueGis.gisEngineUrl+CueGis.GisApi.Fence.save,JSON.stringify(e),function(){if(this.readyState==4&&this.status==201){c.call(null,this.responseText)}},"application/json")};PoiElement.prototype.savePOI=function(a,b){if(!a){throw"poiConfig object cannot be null or undefined"}if(!a.latLng){throw"LatLng is missing"}if(!a.categoryName){throw"Category Name is missing"}if(!a.tagName){throw"Tag Name is missing"}var d=new AjaxRequest();var c="latitude="+a.latLng.lat+"&longitude="+a.latLng.lng+"&categoryName="+a.categoryName+"&tagName="+a.tagName+"&forcePOICategoryCreation="+true;c=c+"&tenantID="+CueGis.tenantID;d.postRequest(CueGis.gisEngineUrl+CueGis.GisApi.POI.save,c,function(){if(this.readyState==4){b.call(null,this.responseText)}},"application/x-www-form-urlencoded")};PoiElement.prototype.loadPOIFromGisEngine=function(b,a){if(!b){throw"poiConfig object cannot be null or undefined"}var e=new AjaxRequest();var c=this;var d="poiTagName="+b.poiName;d=d+"&tenantID="+CueGis.tenantID;e.getRequest(CueGis.gisEngineUrl+CueGis.GisApi.POI.get,d,function(){if(this.readyState==4){var g=JSON.parse(this.responseText);for(var f=0;f<g.length;f++){var h=g[f];c.loadPOI({latitude:h.latLng.latitude,longitude:h.latLng.longitude,markerOptions:b.markerOptions||c.markerOptions,pId:h.id,toolTip:h.tag,pan:b.pan},a)}if(b.callBack){b.callBack.call(this)}}},"text/plain")};PoiElement.prototype.loadPOIUnderCategoryFromGisEngine=function(b,a){if(!b){throw"poiConfig object cannot be null or undefined"}var e=new AjaxRequest();var d="poiCategoryName="+b.categoryName;d=d+"&tenantID="+CueGis.tenantID;var c=this;e.getRequest(CueGis.gisEngineUrl+CueGis.GisApi.POI.getUnderCategory,d,function(){if(this.readyState==4){var f=JSON.parse(this.responseText);for(i=0;i<f.length;i++){var g=f[i];c.loadPOI({latitude:g.latLng.latitude,longitude:g.latLng.longitude,markerOptions:b.markerOptions,pId:g.tag,toolTip:g.tag,pan:b.pan},a)}if(b.callBack){b.callBack.call(this)}}},"text/plain")};TrackingElement.prototype.loadEvent=function(c,a){var b=a.getImplObject();var d=this;var e="gisPID="+c.name;e=e+"&tenantID="+CueGis.tenantID;new AjaxRequest().getRequest(CueGis.gisEngineUrl+CueGis.GisApi.TrackingElement.get,e,function(){if(this.readyState==4){try{var g=JSON.parse(this.responseText);d.createEvent({markerOptions:c.markerOptions,latitude:g.latLng.latitude,longitude:g.latLng.longitude,eventId:c.name,toolTip:"This is"+c.name,pan:true},a)}catch(f){console.log(f)}}},"text/plain")};TrackingElement.prototype.loadEventWithRoute=function(c,a){var b=a.getImplObject();var d=this;var f={};f.tenantID=CueGis.tenantID;f.PIDs=[c.name];f.startDate=c.startDate;f.startIndex=1;f.endIndex=1000;var e=JSON.stringify(f);new AjaxRequest().postRequest(CueGis.gisEngineUrl+CueGis.GisApi.TrackingElement.getWithRoute,e,function(){if(this.readyState==4){try{var h=JSON.parse(this.responseText);if(h.length==0){return}var o=h.length-1;var m=d.createEvent({markerOptions:c.markerOptions,latitude:h[o].latLng.latitude,longitude:h[o].latLng.longitude,eventId:c.name,toolTip:"This is"+h[o].gisPID.PID,pan:true},a);d.highlight(m,{animation:true,animationClass:"circleOutRed"});var g={};g.type="LineString";g.coordinates=[];for(var k=0;k<h.length;k++){var j=[];var l=h[k];j.push(l.latLng.longitude);j.push(l.latLng.latitude);g.coordinates.push(j)}d.loadRoute({geoJson:g,trackingElement:m,routeOptions:{strokeColor:"BLACK",strokeWidth:5}})}catch(n){console.log(n)}}},"application/json")};TrackingElement.prototype.loadTrackingElementInAreaFromGisEngine=function(a,e){var c=this;var b=new AjaxRequest();var f={};f.geoJson=a.area;f.tenantID=CueGis.tenantID;var d=JSON.stringify(f);b.postRequest(CueGis.gisEngineUrl+CueGis.GisApi.TrackingElement.loadWithInArea,d,function(){if(this.readyState==4&&this.status==200){var j=JSON.parse(this.responseText);var l=[];for(var g=0;g<j.length;g++){var h=j[g];var k={};k.toolTip=h.PID;k.pan=true;k.eventId=h.id;k.latitude=h.latLng.latitude;k.longitude=h.latLng.longitude;k.markerOptions=a.markerOptions;c.loadTrackingElement(k,a.palletObject);l.push(h)}e.call(null,l)}},"application/json")};(function(){})();